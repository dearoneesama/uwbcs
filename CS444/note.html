<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Week 1&period; Jan 10</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <p>instructor: Yizhou Zhang</p>
<p>E21736 TTh 10-12:00</p>
<p><a href="https://student.cs.uwaterloo.ca/~cs444/">https://student.cs.uwaterloo.ca/~cs444/</a></p>
<p><a href="https://student.cs.uwaterloo.ca/~cs444/joos/features/">https://student.cs.uwaterloo.ca/~cs444/joos/features/</a></p>
<p><a href="https://uwaterloo.zoom.us/j/99282696444?pwd=R1FCWEgraTJsYWZXVWFlS0NKZ29zUT09">https://uwaterloo.zoom.us/j/99282696444?pwd=R1FCWEgraTJsYWZXVWFlS0NKZ29zUT09</a></p>
<p>assn * 6 (63%) + secret test (10%) + fe (25%)</p>
<ul>
<li><a href="#week-1-jan-10">Week 1. Jan 10</a></li>
<li><a href="#week-2-jan-17">Week 2. Jan 17</a></li>
<li><a href="#week-3-jan-24">Week 3. Jan 24</a></li>
<li><a href="#week-4-jan-31">Week 4. Jan 31</a></li>
<li><a href="#week-5-feb-7">Week 5. Feb 7</a></li>
<li><a href="#week-6-feb-14">Week 6. Feb 14</a></li>
<li><a href="#week-8-feb-28">Week 8. Feb 28</a></li>
<li><a href="#week-9-mar-7">Week 9. Mar 7</a></li>
<li><a href="#week-10-mar-14">Week 10. Mar 14</a></li>
<li><a href="#week-11-mar-21">Week 11. Mar 21</a></li>
<li><a href="#week-12-mar-28">Week 12. Mar 28</a></li>
<li><a href="#week-13-apr-4">Week 13. Apr 4</a></li>
</ul>
<h1 id="week-1-jan-10">Week 1. Jan 10</h1>
<p>big picture:</p>
<ul>
<li>front end (machine independent)
<ul>
<li>lexical analysis (tokenization)</li>
<li>parsing: create AST</li>
<li>semantic analysis: eg decorate AST with types</li>
<li>intermediate code generation</li>
</ul>
</li>
<li>back end
<ul>
<li>optimizations; code generation</li>
<li>register allocation and optimization</li>
</ul>
</li>
</ul>
<p>bigger picture: compiler =&gt; assembler =&gt; linker =&gt; loader</p>
<h2 id="lexingtokenization">lexing/tokenization</h2>
<pre><code class="language-java"><span class="hljs-keyword">if</span> (b == c) <span class="hljs-comment">/* ... */</span> a += <span class="hljs-string">&quot;hi&quot;</span>;
^  ^^ ^  ^^ ^         ^ ^  ^   ^
</code></pre>
<p>tokens: integer literal, string literals, keywords, operators, comment</p>
<p>given input string, we ignore comments, whitespaces (javadoc comments are exception).</p>
<p>the token class includes token type + attribute + metadata (eg source location)</p>
<p><strong>eg.</strong> naive scanning identifier</p>
<pre><code class="language-cpp"><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>:
    <span class="hljs-keyword">auto</span> c = input.<span class="hljs-built_in">read</span>()
    <span class="hljs-keyword">if</span> !<span class="hljs-built_in">idChar</span>(c):
        <span class="hljs-keyword">break</span>
    id.<span class="hljs-built_in">append</span>(c)
</code></pre>
<p>challenges: no backtracking (cannot handle overlapping tokens), no lookaheads</p>
<p>improved:</p>
<pre><code class="language-cpp"><span class="hljs-function"><span class="hljs-keyword">while</span> <span class="hljs-title">idChar</span><span class="hljs-params">(input.peek())</span>:
    id.append(input.read())
</span></code></pre>
<p>one can use <em>regular expressions</em> to define legal tokens to synthesize such lexer code.</p>
<table>
<thead>
<tr>
<th style="text-align:left">R</th>
<th style="text-align:center">L(R)</th>
<th style="text-align:right">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">a</td>
<td style="text-align:center">{&quot;a&quot;}</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">ϵ</td>
<td style="text-align:center">{&quot;&quot;}</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">R|S</td>
<td style="text-align:center">L(R) ∪ L(S)</td>
<td style="text-align:right">alternation</td>
</tr>
<tr>
<td style="text-align:left">R⋅S</td>
<td style="text-align:center">{rs: r∈L(R), s∈L(S)}</td>
<td style="text-align:right">concatenation</td>
</tr>
<tr>
<td style="text-align:left">R*</td>
<td style="text-align:center">L(ϵ) ∪ L(R) ∪ L(RR) ∪ ...</td>
<td style="text-align:right">kleene star</td>
</tr>
</tbody>
</table>
<p>extensions</p>
<table>
<thead>
<tr>
<th style="text-align:left">R</th>
<th style="text-align:center">L(R)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">R?</td>
<td style="text-align:center">R|ϵ</td>
</tr>
<tr>
<td style="text-align:left">R+</td>
<td style="text-align:center">R(R*)</td>
</tr>
<tr>
<td style="text-align:left">[abc]=[a-c]</td>
<td style="text-align:center">a|b|c</td>
</tr>
<tr>
<td style="text-align:left">[^ab]</td>
<td style="text-align:center">any char not a or b</td>
</tr>
<tr>
<td style="text-align:left">.</td>
<td style="text-align:center">[^\n]</td>
</tr>
<tr>
<td style="text-align:left">[^]</td>
<td style="text-align:center">any char</td>
</tr>
</tbody>
</table>
<p>lex generators: lex/flex/jflex/...</p>
<ul>
<li>input: RE + action for each token</li>
<li>output: node that resulted action on matched token</li>
<li>actions:
<ul>
<li>create/discard tokens</li>
<li>raise errors</li>
<li>side effects</li>
</ul>
</li>
<li>abbreviations
<ul>
<li>eg <code>digit = [0-9]</code></li>
<li><code>posint = [1-9]{digit}*</code></li>
<li><code>id = [a-z]{id}*|[a-z]</code> (note: not an RE)</li>
</ul>
</li>
</ul>
<p><em>language matching token rule</em>: always match the longest token.</p>
<p><strong>eg.</strong> how would java tokenize <code>elsex = 0</code> ?  most languages will treat <code>elesx</code> as an identifier.</p>
<p><strong>eg.</strong> how would java tokenize <code>x = +++y</code> ?</p>
<ul>
<li>if we follow longest token rule, then we have <code>&quot;x&quot; &quot;=&quot; &quot;++&quot; &quot;+&quot; &quot;y&quot;</code>, and we have errors.</li>
<li>it would typecheck if we treated it as 3 plus tokens</li>
<li>in Joos, it does not support <code>++</code>, so output error</li>
</ul>
<p><strong>eg.</strong> how would java tokenize <code>a++b</code> ?</p>
<ul>
<li>can have <code>&quot;a&quot; &quot;++&quot; &quot;a&quot;</code> and faills parsing</li>
<li>can have <code>&quot;a&quot; &quot;+&quot; &quot;+&quot; &quot;a&quot;</code> and passes parsing</li>
<li>in Joos, we would have <code>&quot;a&quot; &quot;++&quot; &quot;a&quot;</code> and reject</li>
</ul>
<p><strong>eg.</strong> how would java tokenize <code>List&lt;List&lt;Integer&gt;&gt;</code> ?</p>
<ul>
<li>if we follow longest token rule, then we treat <code>&gt;&gt;</code> as one token and fail</li>
<li>java fixes it by adding a special rule</li>
</ul>
<p>how does lexer generator work?  given spec</p>
<pre><code>spec = re1 {act}
 | re2 {act}
 | ...
// in decreasing order
</code></pre>
<p>it does spec =&gt; NFA =&gt; DFA =&gt; loop + table.</p>
<p><strong>defn.</strong> a <em>DFA</em> consist of:</p>
<ul>
<li>initial state <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">q_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>alphabet Σ</li>
<li>final state F</li>
<li>transition function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi><mo stretchy="false">(</mo><mi>q</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">\delta(q,c)=q&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></li>
</ul>
<pre><code class="language-cpp"><span class="hljs-keyword">auto</span> q = q0
<span class="hljs-keyword">while</span> i &lt;= <span class="hljs-built_in">len</span>(input):
    q = <span class="hljs-built_in">delta</span>(q, input[i]):
    ++i
<span class="hljs-keyword">if</span> q in F:
    ...
</code></pre>
<h1 id="week-2-jan-17">Week 2. Jan 17</h1>
<h3 id="computing-delta">computing delta</h3>
<p>strawman idea: directly map RE to DFA. but things like <code>R1=&quot;IF&quot;,R2=&quot;IDENT&quot;</code> do not not work in general. we need to convert to NFA first.</p>
<p><strong>defn.</strong> an <em>NFA</em> is a DFA plus</p>
<ul>
<li>transitions labelled by ϵ</li>
<li>multiple exit arrows with same label</li>
<li>accepts if there is any way to reach final state</li>
</ul>
<p><strong>algo.</strong> <em>(RE to NFA method)</em> suppose <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mi>R</mi><mo stretchy="false">]</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[[R]]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[[</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">]]</span></span></span></span> denotes a DFA for a regular expression with one enter and one exit state. we use base cases:</p>
<pre><code>               a
[[a]] = -&gt; ◯ ---&gt; ◎

               ϵ
[[ϵ]] = -&gt; ◯ ---&gt; ◎
</code></pre>
<p>and induction cases</p>
<pre><code>                       ϵ
[[R1⋅R2]] = -&gt; [[R1]] ---&gt; [[R2]]  (change R1's final state to non-final)

 
                  [[R1]]
               ϵ /       \ ϵ
[[R1|R2]] =  -&gt; ◯        ◎       (change R1,R2's final state to non-final)
               ϵ \       / ϵ
                  [[R2]]

                 ϵ          ϵ
           -&gt; ◯ ---&gt; [[R]] ---&gt; ◎
               |       ^ |       ^
[[R*]] =       |       | | ϵ     |  (change R's final state to non-final)
               |       +-+       |
               +-----------------+
                        ϵ
</code></pre>
<p><strong>eg.</strong> convert <code>(0|1)*1</code> to NFA.<br>
<img src="assets/w2_1.png" alt="img"></p>
<p>NFA-DFA idea: a DFA state = set of all NFA states that can be reached by reaching same sequence of symbols.</p>
<p><strong>defn.</strong> the ϵ-closure of q is the set of states reachable from q using &gt;= 0 ϵ-edges.</p>
<ul>
<li>base case: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>∈</mo><mi>ϵ</mi><mo>−</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">q\in\epsilon-\mathrm{closure}(q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">closure</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>;</li>
<li>inductive: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>→</mo><msup><mi>q</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mtext> via </mtext><mi>ϵ</mi><mo separator="true">,</mo><msup><mi>q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>∈</mo><mi>ϵ</mi><mo>−</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><msup><mi>q</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>∈</mo><mi>ϵ</mi><mo>−</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">q&#x27;\rightarrow q&#x27;&#x27;\text{ via }\epsilon,q&#x27;\in\epsilon-\mathrm{closure}(q)\implies q&#x27;&#x27;\in\epsilon-\mathrm{closure}(q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mord text"><span class="mord"> via </span></span><span class="mord mathnormal">ϵ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">closure</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">closure</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span></li>
</ul>
<p><strong>eg.</strong> <code>ϵ-closure(G) = {G, H}, ϵ-closure(F) = {F, G, H, A, B, D}, ϵ-closure({G, F}) = ϵ-closure(G) ∪ ϵ-closure(F)</code>.</p>
<p><strong>algo.</strong> <em>(computing ϵ-closure)</em><br>
equations:</p>
<ul>
<li><code>ϵ-closure[q][q] = true</code></li>
<li><code>ϵ-closure[q][q'] = </code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋁</mo><mrow><msup><mi>q</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>→</mo><msup><mi>q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mtext> via </mtext><mi>ϵ</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigvee_{q&#x27;&#x27;\rightarrow q&#x27;\text{ via }\epsilon}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋁</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">→</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord text mtight"><span class="mord mtight"> via </span></span><span class="mord mathnormal mtight">ϵ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span></span></span></span><code>ϵ-closure[q][q'']</code></li>
</ul>
<pre><code class="language-cpp"><span class="hljs-built_in">compute</span>(q):
    <span class="hljs-keyword">for</span> all states q<span class="hljs-number">&#x27;</span> in NFA:
        ϵ-closure[q][q<span class="hljs-number">&#x27;</span>] = <span class="hljs-literal">false</span>
    worklist = {q}
    <span class="hljs-comment">// invariant: q&#x27; equation is not satisfied =&gt; q ∈ worklist&#x27;</span>
    <span class="hljs-keyword">while</span> worklist:
        <span class="hljs-keyword">auto</span> q<span class="hljs-number">&#x27;</span> = worklist.<span class="hljs-built_in">pop</span>()
        update ϵ-closure[q][q<span class="hljs-number">&#x27;</span>] per its equation
        <span class="hljs-keyword">if</span> ϵ-closure[q][q<span class="hljs-number">&#x27;</span>] changed:
            <span class="hljs-keyword">for</span> every q<span class="hljs-number">&#x27;</span> such that q<span class="hljs-number">&#x27;&#x27;</span> -&gt; q<span class="hljs-number">&#x27;</span> via ϵ:
                add q<span class="hljs-number">&#x27;&#x27;</span> to worklist
</code></pre>
<p>correctness:</p>
<ul>
<li>by invariant: equation of each state is satisfied on termination</li>
<li>why it terminates: <code>ϵ-closure[q][q']</code> can only change from 0 to 1, and there are finite number of them</li>
</ul>
<p>complexity: O(N), where N is number of NFA states.</p>
<p><strong>algo.</strong> <em>(construct DFA from NFA)</em></p>
<ul>
<li>initial state of DFA is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi><mo>−</mo><mtext>closure</mtext><mo stretchy="false">(</mo><msub><mi>q</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\epsilon-\textrm{closure}(q_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textrm">closure</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">q_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is NFA's start state</li>
<li>states of DFA: all subsets of DFA states</li>
<li>transitions of DFA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi><mo>−</mo><mtext>closure</mtext><mo stretchy="false">(</mo><msub><mo>⋃</mo><mrow><mi>q</mi><mo>∈</mo><mi>Q</mi></mrow></msub><mo stretchy="false">{</mo><msup><mi>q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>:</mo><mi>q</mi><mo>→</mo><msup><mi>q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mtext> via </mtext><mi>x</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\delta(Q,x)=\epsilon-\textrm{closure}(\bigcup_{q\in Q}\{q&#x27;:q\rightarrow q&#x27;\text{ via }x\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1877em;vertical-align:-0.4358em;"></span><span class="mord text"><span class="mord textrm">closure</span></span><span class="mopen">(</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight">Q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord text"><span class="mord"> via </span></span><span class="mord mathnormal">x</span><span class="mclose">})</span></span></span></span></li>
<li>final states: Q is final state of DFA if any <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>∈</mo><mi>Q</mi></mrow><annotation encoding="application/x-tex">q\in Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> is final state in NFA</li>
</ul>
<p><strong>eg.</strong> convert <code>(0|1)*1</code> to DFA.<br>
<img src="assets/w2_2.png" alt="img"></p>
<p>this DFA is not minimal, we can minimize it. we want to ask when two DFA states are equivalent.</p>
<p><strong>defn.</strong> two DFA states <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_1,Q_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are not equivalent when</p>
<ul>
<li>one of them is final state, and the other is not;</li>
<li>there exists <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> such that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi><mo stretchy="false">(</mo><msub><mi>Q</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\delta(Q_1,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi><mo stretchy="false">(</mo><msub><mi>Q</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\delta(Q_2,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> are not equivalent.</li>
</ul>
<p>use worklist algo, we start with every pair of states being equivalent, and unequate them.</p>
<p><strong>theorem.</strong> <em>(myhill-nerode)</em> for any DFA, there exists a unique minimal DFA accepting some input.</p>
<p>the states SABDGH and CFABDGH are equivalent, so they can be merged.</p>
<p><strong>eg.</strong> suppose we have a spec</p>
<pre><code>spec = R1   {act 1}
       | R2 {act 2}
</code></pre>
<p>and we generate an NFA and a DFA</p>
<pre><code>    ◯ ... ◎ A
  /
◯                    -----&gt; ◯ -&gt; ... ◎ AB
  \
    ◯ ... ◎ B
</code></pre>
<p>the final state contains both A and B. what action should lexer do? it should do action A because of decreasing priority.</p>
<p>finally, the generated code should do</p>
<ul>
<li>run the DFA until stuck</li>
<li>backtrack to the last final state reached (longest matching token rule)</li>
</ul>
<p><strong>eg.</strong> suppose <code>R1=abc, R2=(abc)*d</code>. what does <code>abcabc...abcx</code> match?<br>
lexer will reach <code>x</code> and fail, then it backs up to beginning and match <code>R1</code>. then it starts from the second <code>abc</code> and reach <code>x</code> again, ... the time complexity is O(N^2).</p>
<p>minimization algo of DFA exists to reduce complexity to O(N).</p>
<h3 id="interpreting-res-by-derivatives">interpreting REs by derivatives</h3>
<p>start from regular expression <code>RE0</code>, receive input <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then we transit to regular expression <code>RE1</code> and so on..</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><msub><mi>E</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">RE_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span> is derivative of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><msub><mi>E</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">RE_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> upon consuming <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">x_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>.</li>
</ul>
<p><strong>defn.</strong> the <em>derivative</em> of regular expression <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> wrt <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">\partial aR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> is</p>
<ul>
<li>base cases:
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><mi>a</mi><mo>=</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\partial aa=\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">aa</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><mi>b</mi><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\partial ab=\varnothing</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">ab</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6633em;vertical-align:-0.0817em;"></span><span class="mord amsrm">∅</span></span></span></span> (re that accepts nothing)</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><mi>ϵ</mi><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\partial a\epsilon=\varnothing</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6633em;vertical-align:-0.0817em;"></span><span class="mord amsrm">∅</span></span></span></span></li>
</ul>
</li>
<li>inductive:
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>1</mn></msub><mo>+</mo><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">∂</mi><mi>a</mi><msub><mi>R</mi><mn>1</mn></msub><mo>+</mo><mi mathvariant="normal">∂</mi><mi>a</mi><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\partial a(R_1+R_2)=\partial aR_1+\partial aR_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><msup><mi>R</mi><mo>∗</mo></msup><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">∂</mi><mi>a</mi><mi>R</mi><mo stretchy="false">)</mo><msup><mi>R</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">\partial aR^*=(\partial aR)R^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∂</mi><mi>a</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>1</mn></msub><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">∂</mi><mi>a</mi><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><mi>v</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi mathvariant="normal">∂</mi><mi>a</mi><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\partial a(R_1R_2)=(\partial aR_1)R_2+v(R_1)(\partial aR_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>
<ul>
<li>where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">v(R_1)=\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> accepts empty string, otherwise <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\varnothing</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6633em;vertical-align:-0.0817em;"></span><span class="mord amsrm">∅</span></span></span></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="parsing">parsing</h2>
<p>we use <em>context-free-grammar</em> (rewrite does not depend on context)</p>
<p><strong>eg.</strong></p>
<pre><code>start symbol: S
terminals: + * n ( )
nonterminals: S, E
productions:
  S -&gt; S + S | S * S | E
  E -&gt; n | ( S )
</code></pre>
<p><strong>defn.</strong> a <em>derivation</em> is sequence of rewrites from start symbol to a token stream.</p>
<ul>
<li>at each step, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mi>X</mi><mi>β</mi><mo>→</mo><mi>α</mi><mi>γ</mi><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha X\beta\rightarrow\alpha\gamma\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord mathnormal" style="margin-right:0.05278em;">Xβ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">X\rightarrow\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> is a production.</li>
</ul>
<p><strong>notation.</strong></p>
<ul>
<li>we use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(G)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">G</span><span class="mclose">)</span></span></span></span> to denote the language of grammar G;</li>
<li>a token stream <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∈</mo><mi>L</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\in L(G)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">G</span><span class="mclose">)</span></span></span></span> iff there is a derivation using G;</li>
<li>uppercase english letters are nonterminals;</li>
<li>lowercase english letters are terminals;</li>
<li>greek letters are strings of symbols.</li>
</ul>
<p><strong>eg.</strong> how to derive <code>(1+4)+2</code> ?</p>
<pre><code>S
S + S
E + S             // leftmost derivation:
( S ) + S         // expand leftmost terminal first
( S + S ) + S
( E + E ) + E
( 1 + 4 ) + 2

S
S + S
S + E
S + 2             // rightmost derivation
...
</code></pre>
<p>its parse tree is<br>
<img src="assets/w2_3.PNG" alt="img"></p>
<p>leftmost derivation corresponds to top-down parsing; rightmost derivation corresponds to bottom-up parsing.</p>
<p><strong>defn.</strong> G is ambiguous if some string in L(G) has multiple parse trees.</p>
<p><strong>eg.</strong> <code>1+2*3</code> has two parse trees, so the grammar above is ambiguous. the precedence of <code>+</code> and <code>*</code> is not enforced.</p>
<p><strong>eg.</strong> <code>1+2+3</code> has two parse trees. the associativity of <code>+</code> is not enforced.</p>
<p>fixing ambiguity:</p>
<pre><code>S -&gt; S + T | T
T -&gt; T * F | F
F -&gt; n | ( S )

// precedence left +
// precedence left *
</code></pre>
<p>this defines the same language but unambiguous because</p>
<ul>
<li>cannot have <code>+</code> under <code>*</code></li>
<li>cannot have <code>+</code> under RHS of <code>+</code></li>
</ul>
<p>many parser generators allow specifying precedence and associativity.</p>
<p><strong>eg.</strong> dangling else problem</p>
<pre><code class="language-bash">S -&gt; <span class="hljs-keyword">if</span> E <span class="hljs-keyword">then</span> S
   | <span class="hljs-keyword">if</span> E <span class="hljs-keyword">then</span> S <span class="hljs-keyword">else</span> S
   | ...
</code></pre>
<p>how do we parse <code>if E1 then if E2 then S1 else S2</code> ? we can let the <code>else</code> belong to the inner <code>if</code>, or let it belong to the outer <code>if</code>. most languages choose the first parse (the &quot;closest-if rule&quot;).</p>
<pre><code class="language-bash"><span class="hljs-keyword">if</span> E1 <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> E2 <span class="hljs-keyword">then</span> S1
    <span class="hljs-keyword">else</span> S2
</code></pre>
<p>this grammar is ambiguous. to fix it, we observe there are two kinds of statements</p>
<ul>
<li>U: if-statements ending in an unmatched <code>then</code> =&gt; should not be followed by <code>else</code></li>
<li>M: all other statements</li>
</ul>
<p>we can fix using</p>
<pre><code class="language-bash">S -&gt; M | U
M -&gt; <span class="hljs-keyword">if</span> E <span class="hljs-keyword">then</span> M <span class="hljs-keyword">else</span> M
   | ...
U -&gt; <span class="hljs-keyword">if</span> E <span class="hljs-keyword">then</span> S
   | <span class="hljs-keyword">if</span> E <span class="hljs-keyword">then</span> M <span class="hljs-keyword">else</span> U

// precedence noassoc <span class="hljs-keyword">if</span>
// precedence noassoc <span class="hljs-keyword">else</span>
</code></pre>
<p><strong>eg.</strong> needing context: how to parse <code>HashTable&lt;K, V&gt; x;</code> ? there are 2 solutions</p>
<ol>
<li>lexer receives feedback from later stages from compiler (not ideal)</li>
<li>parser creates parse tree with ambiguous nodes; ambiguity is resolved at later stage</li>
</ol>
<p><strong>eg.</strong> significant whitespace (python): lexer inserts extra indent/dedent tokens.</p>
<h1 id="week-3-jan-24">Week 3. Jan 24</h1>
<h2 id="ll-parsing">LL parsing</h2>
<p>aka top-down parsing / recursive-descent parsing</p>
<p><strong>eg.</strong> given S-expression (scheme)</p>
<pre><code>S -&gt; ( L ) | x
L -&gt; ϵ | S L
</code></pre>
<p>we parse like this</p>
<pre><code class="language-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SExpr</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ListExpr</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SExpr</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Id</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SExpr</span> {}

SExpr <span class="hljs-title function_">parseS</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">switch</span> (peek()) {
        <span class="hljs-keyword">case</span> LPAREN:    <span class="hljs-comment">// S -&gt; (L)</span>
            consume();  <span class="hljs-comment">// LPAREN</span>
            List&lt;SExpr&gt; l = parseL();
            consume();  <span class="hljs-comment">// RPAREN</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListExpr</span>(l);
        <span class="hljs-keyword">case</span> IDENT:     <span class="hljs-comment">// S -&gt; x</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> consume();  <span class="hljs-comment">// IDENT</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Id</span>(id);
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> SyntaxError;
    }
}

List&lt;SExpr&gt; <span class="hljs-title function_">parseL</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">switch</span> (peek()) {
        <span class="hljs-keyword">case</span> ID: <span class="hljs-keyword">case</span> LPAREN:  <span class="hljs-comment">// S -&gt; S L</span>
            <span class="hljs-type">SExpr</span> <span class="hljs-variable">S</span> <span class="hljs-operator">=</span> parseS();
            List&lt;SExpr&gt; l = parseL();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">List</span>&lt;&gt;(s, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListExpr</span>(l));
        <span class="hljs-keyword">case</span> LPAREN:  <span class="hljs-comment">// L -&gt;</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">List</span>&lt;&gt;();
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> SyntaxError;
    }
}
</code></pre>
<p>if we parse <code>&quot;(x x)&quot;</code> we get</p>
<pre><code>       ListExpr
          |
      List&lt;SExpr&gt;
      /        \
     /          \
Id(&quot;x&quot;)        Id(&quot;x&quot;)
</code></pre>
<p>predictive parsing table (PPT) for one lookahead:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">(</th>
<th style="text-align:center">x</th>
<th style="text-align:center">)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">S → (L)</td>
<td style="text-align:center">S → x</td>
<td style="text-align:center">None</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td style="text-align:center">L → SL</td>
<td style="text-align:center">L → SL</td>
<td style="text-align:center">L → ϵ</td>
</tr>
</tbody>
</table>
<p><strong>defn.</strong> a grammar is LL(1) if a 1-lookahead PPT can be constructed.</p>
<p>LL(k&gt;=2) grammars are not generally used. if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Σ</span></span></span></span> represents vocabulary, then there are <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">∣</mi></mrow></msup></mrow><annotation encoding="application/x-tex">2^{|\Sigma|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣Σ∣</span></span></span></span></span></span></span></span></span></span></span></span> columns in a PPT.</p>
<p>to build prediction table, we build 3 tables</p>
<ul>
<li><code>Nullable(X)</code>: true iff X can derive ϵ</li>
<li><code>First(X)</code>: set of tokens that can start X</li>
<li><code>Follow(X)</code>: set of tokens that can follow X</li>
</ul>
<p><strong>eg.</strong> for the S-expr grammar, we get</p>
<pre><code>Nullable(S) = 0
Nullable(L) = 1

First(L) = (, x
Follow(L) = )
</code></pre>
<p>we will build a table such that <code>Cell(x, a)</code> in PPT contains</p>
<ul>
<li><code>X → γ</code> where <code>a ∈ First(γ)</code>.</li>
<li><code>X → γ</code> where <code>Nullable(γ) = 1</code> and <code>a ∈ Follow(X)</code></li>
</ul>
<p><strong>claim.</strong> <em>(proving string is nullable)</em></p>
<ul>
<li><code>ϵ</code> is nullable;</li>
<li>if <code>X → γ ∈ G</code> and <code>γ</code> is nullable, then <code>X</code> is nullable;</li>
<li>if <code>X</code> is nullable and <code>β</code> is nullable, then <code>Xβ</code> is nullable.</li>
</ul>
<p><strong>algo.</strong> <em>(computing nullable using iterative solving)</em><br>
equations:</p>
<ul>
<li><code>Nullable[x] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋁</mo><mrow><mi>X</mi><mo>→</mo><mi>γ</mi><mo>∈</mo><mi>G</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigvee_{X\rightarrow\gamma\in G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋁</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight" style="margin-right:0.05556em;">γ</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight">G</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span></span></span></span><code>Nullable[γ]</code></li>
<li><code>Nullable[γ] =</code>
<ul>
<li>1 if <code>γ = ϵ</code></li>
<li>0 if <code>γ = β</code></li>
<li><code>Nullable[x] ∧ Nullable[β]</code> if <code>γ = Xβ</code></li>
</ul>
</li>
</ul>
<pre><code class="language-cpp"><span class="hljs-keyword">for</span> each nonterminal X:
    nullable[X] = <span class="hljs-number">0</span>
repeat until no more changes:
    <span class="hljs-keyword">for</span> each X in G:
        update nullable[X] per X equation
<span class="hljs-keyword">return</span> nullable
</code></pre>
<p>correctness:</p>
<ul>
<li>nullable mapping can only flip from false to true</li>
<li>partial correctness: by construction</li>
<li>termination: O(N^2)
<ul>
<li>the inner loop has at most O(N) iterations</li>
<li>the outer loop has at most O(N) iterations since each nonterminal flips at most once</li>
</ul>
</li>
</ul>
<p><strong>algo.</strong> <em>(computing nullable using worklist)</em></p>
<pre><code class="language-cpp"><span class="hljs-keyword">for</span> each nonterminal X:
    nullable[X] = <span class="hljs-number">0</span>
<span class="hljs-keyword">auto</span> worklist = {X: X → ϵ ∈ G}
<span class="hljs-comment">// invariant: if X&#x27;s equation is not satisfied, then X is in work list</span>
<span class="hljs-keyword">while</span> worklist is <span class="hljs-keyword">not</span> empty:
    <span class="hljs-keyword">auto</span> X = worklist.<span class="hljs-built_in">pop</span>()
    update nullable[X] per X equation
    <span class="hljs-keyword">if</span> nullable[X] changed:
        <span class="hljs-keyword">for</span> each Z → αXβ ∈ G:
            worklist.<span class="hljs-built_in">add</span>(Z)
<span class="hljs-keyword">return</span> nullable
</code></pre>
<p><strong>claim.</strong> <em>(proving string is in first set)</em></p>
<ul>
<li><code>a ∈ First(aβ)</code> for all <code>β</code></li>
<li>if <code>X → γ ∈ G</code> and <code>a ∈ First(γ)</code>, then <code>a ∈ First(X)</code></li>
<li>if <code>a ∈ First(X)</code>, then <code>a ∈ First(Xβ)</code></li>
<li>if <code>Nullable(X)</code> and <code>a ∈ First(β)</code>, then <code>a ∈ First(Xβ)</code></li>
</ul>
<p>equations:</p>
<ul>
<li><code>First(X) =</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><mi>X</mi><mo>→</mo><mi>γ</mi><mo>∈</mo><mi>G</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{X\rightarrow\gamma\in G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight" style="margin-right:0.05556em;">γ</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight">G</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span></span></span></span><code>First(γ)</code></li>
<li><code>First(γ) =</code>
<ul>
<li>∅ if <code>γ = ϵ</code></li>
<li><code>{a}</code> if <code>γ = aβ</code></li>
<li><code>First(X)</code> if <code>γ = Xβ</code> and <code>X</code> is not nullable</li>
<li><code>First(X) ∪ First(β)</code> if <code>γ = Xβ</code> and <code>X</code> is nullable</li>
</ul>
</li>
</ul>
<p>we can similarly provide two algos to compute first.</p>
<p><strong>claim.</strong> <em>(proving string is in follow set)</em></p>
<ul>
<li>if <code>Y → aXβ ∈ G</code> and <code>a ∈ First(β)</code>, then <code>a ∈ Follow(X)</code></li>
<li>if <code>Y → aXβ ∈ G</code> and <code>Nullable(β) = 1</code> and <code>a ∈ Follow(Y)</code>, then <code>a ∈ Follow(X)</code></li>
</ul>
<p>equation: <code>Follow(X) = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><mi>Y</mi><mo>→</mo><mi>α</mi><mi>X</mi><mi>β</mi><mo>∈</mo><mi>G</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{Y\rightarrow\alpha X\beta\in G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1864em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">Xβ</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight">G</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span></span></span></span><code>(First(β) ∪ (if Nullable(β) then Follow(Y) else ∅))</code></p>
<p><strong>eg.</strong> failing cases: Cell(X,a) has &gt;= productions.<br>
we can use LL(2+), but it causes state explosion. we can use following tricks:</p>
<p>(1) shared first set:</p>
<pre><code>L -&gt; S | S L  // not LL(1)

fix:
L  -&gt; S L'
L' -&gt; ϵ | L
</code></pre>
<p>(2) left recursion</p>
<pre><code>L -&gt; S | L + S  // not LL(k) since First(L+S) = First(S)

fix:
L -&gt; S(+S)*      // parse (+S)* using a loop
</code></pre>
<pre><code class="language-java">Expr <span class="hljs-title function_">parseL</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Expr</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> parseS();
    <span class="hljs-keyword">while</span> (peek()) {
        consume();  <span class="hljs-comment">// &#x27;+&#x27;</span>
        result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Plus</span>(result, parseS());
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h2 id="earley-parser">earley parser</h2>
<p>problem with top-down parsing: must predict production before seeing entire input going into the production. this is not required for button-up parsing.</p>
<p>earley parser: chooses productions as late as it can</p>
<ul>
<li>can handle all CFG</li>
<li>can handle ambiguous grammars =&gt; creates 'parse forest'</li>
</ul>
<p>straw man: fork off a parser thread for each possible production.</p>
<p>key idea: simulates threads in poly time by tracking all parses as sets of (earley) items.</p>
<ul>
<li>an <em>earley item</em> is <code>[A → β•γ, i]</code>
<ul>
<li>where <code>A → βγ</code> is a CFG production</li>
<li><code>•</code> is current input position</li>
<li><code>i</code> is input position where thread for this item was spawned</li>
</ul>
</li>
<li>processes input left-to-right, one token at a time</li>
<li>for each input position <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>, construct a set of items <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">I_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>start from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mn>0</mn></msub><mo>=</mo></mrow><annotation encoding="application/x-tex">I_0=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span><code>{[S' → •S, 0]}</code></li>
<li>CFG accepts input <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_0...a_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">...</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">I_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> contains <code>[S' → S•, 0]</code></li>
</ul>
<p><strong>algo.</strong> <em>(how to construct <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">I_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)</em>:</p>
<pre><code class="language-cpp"><span class="hljs-keyword">for</span> each j:
    <span class="hljs-keyword">do</span> until no changes to I[j]:
        scan:
        <span class="hljs-keyword">if</span> [A→β•cγ,k] ∈ I[j], next token is c:
            add [A→βc•γ,k] to I[j+<span class="hljs-number">1</span>]
        predict:
        <span class="hljs-keyword">if</span> [A→β•Cγ,k] ∈ I[j]:
            <span class="hljs-keyword">for</span> all C→γ ∈ G, add [C→•γ,j] to I[j]:
        complete:
        <span class="hljs-keyword">if</span> [C→γ•,k] ∈ I[j] <span class="hljs-keyword">and</span> [A→β•Cδ,m] ∈ I[k]:
            add [A→βC•δ,m] to I[j]
</code></pre>
<p><strong>eg.</strong></p>
<pre><code>S -&gt; S + E | E
E -&gt; n | ( S )

input: (1)+2

I[0] = [S'→•S,0], [S→•S+E,0], [S→•E,0], [E→•n,0], [E→•(S),0]

get (:
  I[1] = [E→(•S),0] [S→•S+E,1], [S→•E,1], [E→•n,1], [E→•(S),1]
get 1:
  I[2] = [E→n•,1], [S→E•,1], [E→(S•),0], [S→S•+E,1]
get ):
  I[3] = [E→(S)•,0], [S→E•,0], [S'→S•,0], [S→S•+E,0]
get +:
  I[4] = [S→S+•E,0], [E→•n,4], [E→•(S),4]
get 2:
  I[5] = [E→n•,4], [S→S+E•,0], [S'→S•,0], [S→S•+E,0]
                                   ^
                            successful thread
</code></pre>
<p>the derivation in successful thread is</p>
<pre><code>S' -&gt; S -&gt; S+E -&gt; S+2 -&gt; E+2 -&gt; (S)+2 -&gt; (E)+2 -&gt; (1)+2
</code></pre>
<p>time complexity: O(n^3) for arbitrary CFG; O(n^2) for unambiguous grammars; O(n) for LR(k) grammar with optimization (eg doing lookahead in complete operation)</p>
<h2 id="lr-parsing">LR parsing</h2>
<p>a specialization of earley parser. we precompute a parsing table (DFA) with which parser knows whether to scan or complete.</p>
<p>aka shift-reduce parser =&gt; shift is scan + prediction (closure), reduce is complete</p>
<p><strong>eg.</strong> parse the same <code>(1)+2</code>.</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:center">stack</th>
<th style="text-align:right">unconsumed</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"></td>
<td style="text-align:center"></td>
<td style="text-align:right">(1)+2</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:center">(</td>
<td style="text-align:right">1)+2</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:center">(1</td>
<td style="text-align:right">)+2</td>
</tr>
<tr>
<td style="text-align:left">reduce E→n</td>
<td style="text-align:center">(E</td>
<td style="text-align:right">)+2</td>
</tr>
<tr>
<td style="text-align:left">reduce S→E</td>
<td style="text-align:center">(S</td>
<td style="text-align:right">)+2</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:center">(S)</td>
<td style="text-align:right">+2</td>
</tr>
<tr>
<td style="text-align:left">reduce E→(S)</td>
<td style="text-align:center">E</td>
<td style="text-align:right">+2</td>
</tr>
<tr>
<td style="text-align:left">reduce S→E</td>
<td style="text-align:center">S</td>
<td style="text-align:right">+2</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:center">S+</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:center">S+2</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">reduce E→n</td>
<td style="text-align:center">S+E</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">reduce S→S+E</td>
<td style="text-align:center">S</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>LR parsing table: given current stack and current lookahead token, tells whether shift or reduce (and which production)</p>
<p>the table can be ambiguous: shift-reduce conflicts and reduce-reduce conflicts.</p>
<h1 id="week-4-jan-31">Week 4. Jan 31</h1>
<p>in LR(k) parser, it has</p>
<ul>
<li>k lookahead tokens</li>
<li>a stack of symbols and automaton states (parser state)</li>
</ul>
<h3 id="lr0-parser">LR(0) parser</h3>
<p>the automaton state is a set of LR(0) items <code>[X → α•β]</code> (not parser state).</p>
<p><strong>algo.</strong> <em>(construct LR(0) automaton)</em></p>
<ol>
<li><code>initial_state = ϵ-closure[S' → •S$]</code></li>
<li>do until no more states or transitions:
<ol>
<li>for each symbol to right of <code>•</code> in some state:
<ol>
<li>add transition to a state with all matching terms advanced and closure taken</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>eg.</strong></p>
<pre><code>S -&gt; S + E | E
E -&gt; n | ( S )
</code></pre>
<p><img src="assets/w4_1.PNG" alt="img"></p>
<p>how to use the DFA:</p>
<ul>
<li>when we read a token and transit, push token and state to stack</li>
<li>if we read a token that does not have transition, then it is syntax error.</li>
<li>after reaching a terminal state <code>X→γ•</code>, we reduce. we pop <code>γ</code> and its states from stack and push <code>X</code> into stack. find next state by walking back <code>|γ|</code> states.</li>
</ul>
<p><strong>eg.</strong> parse <code>(1+2)</code>.</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">stack</th>
<th style="text-align:right">unconsumed input</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">o</td>
<td style="text-align:right">(1+2)$</td>
</tr>
<tr>
<td style="text-align:left">shift 2</td>
<td style="text-align:left">o(<sub>2</sub></td>
<td style="text-align:right">1+2)$</td>
</tr>
<tr>
<td style="text-align:left">shift 1</td>
<td style="text-align:left">o(<sub>2</sub>1<sub>1</sub></td>
<td style="text-align:right">+2)$</td>
</tr>
<tr>
<td style="text-align:left">reduce E→n</td>
<td style="text-align:left">o(<sub>2</sub>E</td>
<td style="text-align:right">+2)$</td>
</tr>
<tr>
<td style="text-align:left">goto 3</td>
<td style="text-align:left">o(<sub>2</sub>E<sub>3</sub></td>
<td style="text-align:right">+2)$</td>
</tr>
<tr>
<td style="text-align:left">reduce S→E</td>
<td style="text-align:left">o(<sub>2</sub>S</td>
<td style="text-align:right">+2)$</td>
</tr>
<tr>
<td style="text-align:left">goto 4</td>
<td style="text-align:left">o(<sub>2</sub>S<sub>4</sub></td>
<td style="text-align:right">+2)$</td>
</tr>
<tr>
<td style="text-align:left">shift 5</td>
<td style="text-align:left">o(<sub>2</sub>S<sub>4</sub>+<sub>5</sub></td>
<td style="text-align:right">2)$</td>
</tr>
<tr>
<td style="text-align:left">shift 1</td>
<td style="text-align:left">o(<sub>2</sub>S<sub>4</sub>+<sub>5</sub>2<sub>1</sub></td>
<td style="text-align:right">)$</td>
</tr>
<tr>
<td style="text-align:left">reduce E→n</td>
<td style="text-align:left">o(<sub>2</sub>S<sub>4</sub>+<sub>5</sub>E<sub>7</sub></td>
<td style="text-align:right">)$</td>
</tr>
<tr>
<td style="text-align:left">reduce S→S+E</td>
<td style="text-align:left">o(<sub>2</sub>S<sub>4</sub></td>
<td style="text-align:right">)$</td>
</tr>
<tr>
<td style="text-align:left">shift 6</td>
<td style="text-align:left">o(<sub>2</sub>S<sub>4</sub>)</td>
<td style="text-align:right">$</td>
</tr>
<tr>
<td style="text-align:left">reduce E→(S)</td>
<td style="text-align:left">oE<sub>3</sub></td>
<td style="text-align:right">$</td>
</tr>
<tr>
<td style="text-align:left">reduce S→E</td>
<td style="text-align:left">oS<sub>8</sub></td>
<td style="text-align:right">$</td>
</tr>
<tr>
<td style="text-align:left">shift 9</td>
<td style="text-align:left">oS<sub>8</sub>$<sub>9</sub></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">reduce S'→S$</td>
<td style="text-align:left">S'</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>SLR parsing: reduce <code>X→γ</code> only if lookahead <code>a ∈ Follow(X)</code>.</p>
<p><strong>eg.</strong> SLR can help shift-reduce conflict</p>
<pre><code>S -&gt; E + S | E
E -&gt; n | ( S )
</code></pre>
<p><img src="assets/w4_2.PNG" alt="img"></p>
<h3 id="lr1-parsing">LR(1) parsing</h3>
<p>an LR(1) item is <code>[X → α•β, λ]</code> = LR(0) item + 1 lookahead set.</p>
<ul>
<li>note <code>λ</code> are tokens that could appear after β</li>
</ul>
<p>construction of LR(1) automaton is same as LR(0), however the closure of LR(1) item is different: if state includes <code>[X → α•Yβ, λ]</code>, then new state should include items <code>[Y → •γ, λ']</code> where</p>
<ul>
<li><code>Y → γ ∈ CFG</code></li>
<li><code>λ' = First(β)</code> if <code>Nullable[β] = false</code></li>
<li><code>λ' = First(β) ∪ λ</code> otherwise</li>
</ul>
<p><strong>eg.</strong></p>
<pre><code>S -&gt; E + S | E
E -&gt; n | ( S )
</code></pre>
<p><img src="assets/w4_3.PNG" alt="img"></p>
<p>for unambiguous grammar,</p>
<ul>
<li>lookahead sets of reduce items do not overlap</li>
<li>lookahead set of a reduce item does not overlap with shift item</li>
</ul>
<p><strong>eg.</strong> precedence left plus</p>
<pre><code>E -&gt; E + E | E * E

+---------------
|E → E+E•    +     &lt;- reduce E→E+E on +
|E → E•+E    ...   &lt;- shift on +
+---------------

+---------------
|E → E*E•    +     &lt;- reduce E→E*E on +
|E → E•+E    ...   &lt;- shift on +
+---------------
</code></pre>
<p>the conflict can be solved by specifying</p>
<pre><code>precedence left PLUS;
precedence left TIMES;
</code></pre>
<h3 id="lalr1-parsing">LALR(1) parsing</h3>
<p>LR(1) automaton has too many states. LALR(1) merges LR(1) states with same LR(0) items into an LALR(1) state.</p>
<p><strong>eg.</strong></p>
<pre><code>two LR(1) states, unambiguous
+------------+     +------------+
|E → n•    + |     |E → n•    $ |
|E → E+n•  + |     |E → E+n•  $ |
+------------+     |------------+

one LALR(1) state, ambiguous
+-------------+
|E → n•    $+ |
|E → E+n•  $+ |
+-------------+
</code></pre>
<p>venn diagram:<br>
<img src="assets/w4_4.PNG" alt="img"></p>
<h3 id="ast">AST</h3>
<p>the parser creates a parse tree, which is different from the AST.</p>
<p>ast design principle: don't fight your language</p>
<ul>
<li>oop: use class hierarchy with method dispatch: Node class, Unary|binaryExpr class, Stmt class, etc.</li>
<li>fp: use variant type with pattern matching</li>
</ul>
<p>how do parsers construct ASTs:</p>
<ul>
<li>recursive descent: recursive function returns AST</li>
<li>bottom-up parser: AST constructed on reduce</li>
</ul>
<p><strong>eg.</strong> specify action on the parser generator</p>
<pre><code>expr := expr:e1 PLUS expr:e2 { RESULT = new BinaryExpr(op.Plus, e1, e2) }

stack before reduce:
( E + E
  ^   ^
  e1  e2

stack after reduce:
( E
  ^
 BinaryExpr(...)
</code></pre>
<h2 id="semantic-analysis">semantic analysis</h2>
<p>this pass either</p>
<ul>
<li>catch semantic errors (no more errors from now on)</li>
<li>returns valid, decorated AST</li>
</ul>
<p>valid = well-formed</p>
<ul>
<li>acyclic class hierarchy</li>
<li>no uninitialized variables</li>
<li>no type errors</li>
</ul>
<p>decorated = extra info useful for later passes</p>
<ul>
<li>types</li>
<li>data layout</li>
</ul>
<p><strong>eg.</strong> need to resolve names.</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> p;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
      ^ <span class="hljs-comment">// declaration of name</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> x;
    A <span class="hljs-title function_">A</span><span class="hljs-params">(A A)</span> {
    ^ - ^ = <span class="hljs-comment">// reference, declaration, reference, declaration</span>
        <span class="hljs-keyword">return</span> (A)A.A(A);
                ^ = - =  <span class="hljs-comment">// all references</span>
    }
}
</code></pre>
<p>how to represent declaration of names?</p>
<ul>
<li>option 1: declaration as ASTs; references point to declaration's AST
<ul>
<li>problems:
<ul>
<li>ASTs not always available: source references bytecodes</li>
<li>inefficient: implies we have to do AST traversals in type checking</li>
<li>error-prone</li>
</ul>
</li>
</ul>
</li>
<li>options 2: declaration as class objects, method objects, local var objects, etc.</li>
</ul>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> p;
<span class="hljs-keyword">import</span> q.*;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> {
    D y;
    <span class="hljs-type">int</span> <span class="hljs-variable">z</span> <span class="hljs-operator">=</span> A.x;
    ... y.w.z ...
}

<span class="hljs-keyword">package</span> q;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">C</span> { C w;}

<span class="hljs-keyword">package</span> q;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> { String z; }
</code></pre>
<p>first step: define environment (context/symbol table), which maps symbols to objects:</p>
<p><img src="assets/w4_5.PNG" alt="img"></p>
<p>second step: resolve uses of type names to class objects.</p>
<p>do we want to combine 1st and 2nd steps into a single AST traversal? no, there are mutual recursive classes.</p>
<p>note qualified names like <code>a.b.c.d</code> are deferred until type checking.</p>
<p>third step: preliminary checking on class hierarchy.</p>
<p><strong>notation.</strong></p>
<ul>
<li>suppose we have code <code>class A extends B implements C, D, E {}</code>, we say <code>super(A) = {B,C,D,E}</code>.</li>
<li>suppose we have code <code>interface F extends G, H, I</code>, we say <code>super(F) = {G,H,I}</code></li>
</ul>
<p><strong>defn.</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> is subtype of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>, ie <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>&lt;</mo><mo>:</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">A&lt;:B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>,</p>
<ul>
<li>if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>∈</mo><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi></mrow><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B\in\mathrm{super}(A)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">super</span></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span></span></span></span>;</li>
<li>or if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>&lt;</mo><mo>:</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">A&lt;:T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&lt;</mo><mo>:</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">T&lt;:B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>.</li>
</ul>
<p><strong>defn.</strong> <code>Declare(T)</code> = methods and fields that are derived in class/interface T</p>
<ul>
<li>method <code>m ∈ Declare(T)</code>: <code>name(m), sig(m), mods(m), type(m)</code>
<ul>
<li>sig includes name and params</li>
</ul>
</li>
<li>field <code>f ∈ Declare(T)</code>: <code>name(f), type(f), mods(f)</code></li>
</ul>
<p><strong>defn.</strong></p>
<ul>
<li><code>Inherit(T)</code> = set of methods and fields inherited into T</li>
<li><code>Contain(T)</code> = <code>Declare(T) ∪ Inherit(T)</code></li>
<li><code>Replace</code> = binary relation between methods
<ul>
<li><code>(m, m') ∈ Replace</code> means 'm replaces m''</li>
<li>m is static: m hides m'</li>
<li>m is nonstatic: m overrides m'</li>
</ul>
</li>
</ul>
<h1 id="week-5-feb-7">Week 5. Feb 7</h1>
<p><em>replace</em>:</p>
<ul>
<li>if <code>S ∈ Super(T), sig(m) = sig(m'), m' ∈ Contain(S), m ∈ Declare(T)</code>, then <code>(m, m') ∈ Replace</code>
<ul>
<li>T inherits from S. T and S both define m.</li>
</ul>
</li>
<li>if <code>S ∈ Super(T), m ∈ Contain(S), S' ∈ Super(T), m'∈ Contain(S'), sig(m) = sig(m'), abstract ∈ mods(m'), abstract !∈ mods(m), NoDecl(T, m)</code>, then <code>(m, m') ∈ Replace</code>
<ul>
<li>T inherits from S and S'. S::m is concrete and S'::m is abstract. T does not define m.</li>
<li>where <code>NoDecl(T, m) := ∀m' ∈ Declare(T), sig(m') !m sig(m)</code></li>
</ul>
</li>
</ul>
<p><em>inherit</em>:</p>
<ul>
<li>if <code>m ∈ Contain(S), S ∈ Super(T), NoDecl(T, m), abstract !∈ mods(m)</code>, then <code>m ∈ Inherit(T)</code>
<ul>
<li>T inherits from S. S defines m.</li>
</ul>
</li>
<li>if <code>m ∈ Contain(S), S ∈ Super(T), NoDecl(T, m); ∀S' ∈ Super(T) ∀m' ∈ Contain(S'), sig(m) = sig(m') =&gt; abstract ∈ mods(m')</code>, then <code>m ∈ Inherit(T)</code>
<ul>
<li>T inherits from S and S'. S defines m, S' deines m'.</li>
</ul>
</li>
<li>if <code>f ∈ Contain(S), S ∈ Super(T); ∀f' ∈ Declare(T), name(f') != name(f)</code>, then <code>f ∈ Inherit(T)</code></li>
</ul>
<p>technicality: <code>java.lang.Object</code> is a supertype of all class and interface types. methods <code>equals(Object)</code>, <code>hashCode()</code>, <code>toString()</code> are implicitly in the <code>Declare</code> of an interface.</p>
<p><strong>eg.</strong> a protected method must not replace a public method.<br>
this translates to <code>∀(m, m') ∈ Replace, public ∈ mods(m') =&gt; protected !∈ mods(m)</code>.</p>
<p><strong>eg.</strong> a method must not replace a method with a different return type.<br>
this translates to <code>∀(m, m') ∈ Replace, type(m) = type(m')</code> (no covariance).</p>
<h3 id="symbol-table">symbol table</h3>
<p>an ast traversal will decorate the AST with types:</p>
<pre><code class="language-java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Expr</span> {
    Optional&lt;Type&gt; type;  <span class="hljs-comment">// initially null, filled by typechecking</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">typeCheck</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SemanticError;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BinExpr</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expr</span> {
    Op op;
    Exp left, right;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">typeCheck</span><span class="hljs-params">()</span> {
        left.typeCheck();
        right.typeCheck();
        <span class="hljs-keyword">switch</span> (op) {
            <span class="hljs-keyword">case</span> PLUS: {
                <span class="hljs-keyword">if</span> (left.type.eq(Int) &amp;&amp; right.type.eq(Int)) {
                    <span class="hljs-built_in">this</span>.type = Int;
                    <span class="hljs-keyword">return</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (left.type.eq(StringTy) || right.type.eq(StringTy)) {
                    <span class="hljs-built_in">this</span>.type = StringTy;
                    <span class="hljs-keyword">return</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SemanticError</span>();
                }
            }
            <span class="hljs-keyword">case</span> ...
        }
    }
}
</code></pre>
<p>we need context to remember names</p>
<pre><code class="language-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Context</span> {
    Type <span class="hljs-title function_">get</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> UnboundIdent;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String name, Type type)</span> <span class="hljs-keyword">throws</span> BoundIdent;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalVar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expr</span> {
    String name;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">typeCheck</span><span class="hljs-params">(Context c)</span> {
        <span class="hljs-built_in">this</span>.type = c.get(<span class="hljs-built_in">this</span>.name);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalVarDeclare</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Stmt</span> {
    String name;
    TypeNode tn;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">typeCheck</span><span class="hljs-params">(Context c)</span> {
        tn.typeCheck(c);
        <span class="hljs-keyword">try</span> {
            c.get(name);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SemanticError</span>(<span class="hljs-string">&quot;already declared&quot;</span>);
        } <span class="hljs-keyword">catch</span> (UnboundIdent) {
            c.put(name, tn.type);
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Block</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Stmt</span> {
    List&lt;Stmt&gt; stmts;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">typeCheck</span><span class="hljs-params">(Context c)</span> {
        c.pushFrame();  <span class="hljs-comment">// or clone and discard</span>
        <span class="hljs-keyword">for</span> (s : stmts) {
            s.typeCheck();
        }
        c.popFrame();
    }
}
</code></pre>
<p>implement the context using a stack of hashtables.</p>
<ul>
<li>entry: push table O(1)</li>
<li>exit: pop table O(1)</li>
<li>put: O(1)</li>
<li>get: O(depth)</li>
</ul>
<h3 id="ast-traversal">AST traversal</h3>
<p>ast traversal is used in</p>
<ul>
<li>environment building</li>
<li>type linking</li>
<li>type check</li>
<li>build CFG</li>
<li>generate intermediate code</li>
<li>generate x86 (with intermediate code)</li>
</ul>
<p>OO style: all AST nodes have a <code>typeCheck()</code> method that does traversal:</p>
<ul>
<li>+ all code about AST type in one place</li>
<li>- boilerplate code repeated in all passes</li>
<li>- awkward to add new passes</li>
</ul>
<p>FP style: a <code>typeCheck()</code> function does pattern matching</p>
<ul>
<li>+ all code about a pass in one place</li>
<li>- boilerplate</li>
<li>- awkward to add new AST constructors</li>
</ul>
<p>resolve tension</p>
<ul>
<li>better programming language features (C# extension methods, OCaml polymorphic variants, Julia multimethods, family polymorphism)</li>
<li>design pattern: data types a la carte (FP), visitor pattern (OOP)</li>
</ul>
<pre><code class="language-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Visitor</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitBinExpr</span><span class="hljs-params">(BinRxpr e)</span> {}
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitIf</span><span class="hljs-params">(If n)</span> {}
    ...
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeChecker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Visitor</span> {
    Context c;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitBinExpr</span><span class="hljs-params">(BinExpr r)</span> {
        <span class="hljs-type">var</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> e.left.type, t2 = e.right.type;
        <span class="hljs-comment">// compare if t1 and t2 are compatible</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BinExpr</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor v)</span> {
        left.accept(v);
        right.accept(v);
        v.visitBinExpr(<span class="hljs-built_in">this</span>);
    }
}
</code></pre>
<ul>
<li>+ easy to add new passes</li>
<li>+ avoid boilerplate</li>
<li>- awkward to add new AST types</li>
</ul>
<h3 id="types">types</h3>
<p>at compile time = statically; at run time = dynamically.</p>
<p>static type = type at compile time + type checking at compile time</p>
<ul>
<li>+ types are approximations of runtime behavior =&gt; generate faster code</li>
<li>+ programmer guidance</li>
<li>- annotation is harder (can be somewhat alleviated by type interference)</li>
</ul>
<p>dynamic typing = values carry types at run time + type checking at run time</p>
<ul>
<li>- runtime cost</li>
<li>- hard to generate faster code</li>
<li>+ no annotation burden</li>
</ul>
<p>strong typing ≈ no undefined behaviors</p>
<ul>
<li>ok to nondeterminism</li>
<li>eg C is not strongly typed</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">strong typing</th>
<th style="text-align:center">weak typing</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">static typing</td>
<td style="text-align:center">ocaml, haskell</td>
<td style="text-align:center">C/C++</td>
</tr>
<tr>
<td style="text-align:center">static &amp; dynamic typing</td>
<td style="text-align:center">Java, C#</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">dynamic typing</td>
<td style="text-align:center">javascript, python</td>
<td style="text-align:center">perl, postscript</td>
</tr>
<tr>
<td style="text-align:center">untyped</td>
<td style="text-align:center">λ-calculus, assembly</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>static type checking:</p>
<ul>
<li>whether program goes wrong at run time is undecidable</li>
<li>idea: use static type checking to ensure well-typed programs do not go wrong at run time
<ul>
<li>program is <em>well-typed</em> if it satisfies the type system (rules)</li>
<li><em>sound typing/type safety</em>: statically well-typed =&gt; dynamically cannot go wrong</li>
<li><em>complete typing</em>: dynamically cannot go wrong =&gt; statically well-typed</li>
</ul>
</li>
</ul>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-type">Map</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();
m.put(<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;bar&quot;</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> m.get(<span class="hljs-string">&quot;foo&quot;</span>);  <span class="hljs-comment">// m.get() returns Object</span>
</code></pre>
<p>the program will run successfully. but it does not typecheck in Joos.</p>
<p>the design of a type system is balancing act.</p>
<p>decidability of type checking:</p>
<ul>
<li>most type systems are decidable (eg Joos)</li>
<li>java's type system is undecidable (because of wildcards supertype constraints)</li>
</ul>
<p>types in Joos:</p>
<pre><code>τ,σ ::= C (class/interface type)
    | boolean | short | byte | char | int
    |'null type'
    | void (return type)
    | τ[] (τ is C, boolean, ..., int)
</code></pre>
<p>types in other languages:</p>
<ul>
<li>function types <code>τ1 -&gt; τ2</code></li>
<li>array types <code>τ[]</code> and <code>τ[e]</code> (dependent typing)</li>
<li>product/tuple types <code>τ1 * τ2 * ... * τn</code></li>
<li>record types <code>{f1: τ1, ..., fn: τn}</code>
<ul>
<li>C structs: nominal record types</li>
</ul>
</li>
<li>sum/union/variant types <code>τ1 + ... + τn</code></li>
<li>algebraic data types <code>data T = x1: τ1 -&gt; T | ... | xn: τn -&gt; T</code></li>
<li>pointer types</li>
<li>parameterized types <code>class Cell&lt;T&gt; { T content; }</code>
<ul>
<li>is a function (type constructor)</li>
</ul>
</li>
</ul>
<p>formalizing type system:</p>
<ul>
<li>typing rules: declarative spec for type system</li>
<li><em>typing judgement form</em>:
<ul>
<li>expression: <code>Γ ⊢  e : τ</code> , where <code>Γ</code> iis context, <code>e</code> is expr, <code>τ</code> is static type</li>
<li>statement: <code>Γ; σ ⊢ S</code>, where <code>σ</code> is return type of current function</li>
</ul>
</li>
<li>type system is a proof system of typing rules</li>
</ul>
<p><strong>eg.</strong> some typing rules</p>
<ul>
<li>plus: <code>(Γ ⊢ e1: int, Γ ⊢ e2: int) =&gt; Γ ⊢ e1 + e2: int</code></li>
<li>var: <code>x: τ in Γ =&gt; Γ ⊢ x: τ</code></li>
<li>intliteral: <code>Γ ⊢ n: int</code></li>
</ul>
<p><strong>eg.</strong> typing derivation is a proof tree</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mfrac><mrow></mrow><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo><mn>2</mn><mo>:</mo><mtext mathvariant="monospace">int</mtext></mrow></mfrac><mtext>(intlit)</mtext><mo separator="true">,</mo><mfrac><mrow><mfrac><mrow><mi>y</mi><mo>:</mo><mtext mathvariant="monospace">int</mtext><mo>∈</mo><mi mathvariant="normal">Γ</mi></mrow><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo><mi>y</mi><mo>:</mo><mtext mathvariant="monospace">int</mtext></mrow></mfrac><mtext>(var)</mtext><mo separator="true">,</mo><mfrac><mrow></mrow><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo><mn>3</mn><mo>:</mo><mtext mathvariant="monospace">int</mtext></mrow></mfrac><mtext>(intlit)</mtext></mrow><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo><mi>y</mi><mo>∗</mo><mn>3</mn><mo>:</mo><mtext mathvariant="monospace">int</mtext></mrow></mfrac><mtext>(times)</mtext></mrow><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo><mn>2</mn><mo>+</mo><mi>y</mi><mo>∗</mo><mn>3</mn><mo>:</mo><mtext mathvariant="monospace">int</mtext></mrow></mfrac><mtext>(plus)</mtext></mrow><annotation encoding="application/x-tex">\cfrac{\cfrac{}{\Gamma\vdash2:\texttt{int}}\text{(intlit)},\cfrac{\cfrac{y:\texttt{int}\in\Gamma}{\Gamma\vdash y:\texttt{int}}\text{(var)},\cfrac{}{\Gamma\vdash3:\texttt{int}}\text{(intlit)}}{\Gamma\vdash y*3:\texttt{int}}\text{(times)}}{\Gamma\vdash2+y*3:\texttt{int}}\text{(plus)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.0113em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.1309em;"><span style="top:-4.1744em;"><span class="pstrut" style="height:4.8604em;"></span><span class="mord"><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">int</span></span></span></span><span style="top:-5.0904em;"><span class="pstrut" style="height:4.8604em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-6.1309em;"><span class="pstrut" style="height:4.8604em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">int</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mord text"><span class="mord">(intlit)</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604em;"><span style="top:-2.904em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">int</span></span></span></span><span style="top:-3.82em;"><span class="pstrut" style="height:3.59em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.8604em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">int</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">int</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">Γ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span><span class="mord text"><span class="mord">(var)</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">int</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mord text"><span class="mord">(intlit)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span><span class="mord text"><span class="mord">(times)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span><span class="mord text"><span class="mord">(plus)</span></span></span></span></span></span></p>
<p>where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Γ</mi><mo>=</mo><mi>x</mi><mo>:</mo><mtext mathvariant="monospace">bool</mtext><mo separator="true">,</mo><mi>y</mi><mo>:</mo><mtext mathvariant="monospace">int</mtext></mrow><annotation encoding="application/x-tex">\Gamma=x:\texttt{bool},y:\texttt{int}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8055em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord texttt">bool</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6111em;"></span><span class="mord text"><span class="mord texttt">int</span></span></span></span></span>.</p>
<p>some Joos typing rules:</p>
<ul>
<li>literals:
<ul>
<li><code>Γ ⊢ 3: int</code></li>
<li><code>Γ ⊢ true: boolean</code></li>
<li><code>Γ ⊢ null: NullType</code></li>
<li><code>Γ ⊢ &quot;123&quot;: String</code></li>
</ul>
</li>
<li>variables:
<ul>
<li><code>x: τ in Γ =&gt; Γ ⊢ x: τ</code></li>
<li>note a special &quot;this&quot; variable</li>
</ul>
</li>
<li>operators:
<ul>
<li><code>Γ ⊢ e: boolean =&gt; Γ ⊢ !e: boolean</code></li>
<li><code>(Γ ⊢ e1: String, Γ ⊢ e2: τ2, τ2 != void) =&gt; Γ ⊢ e1 + e2: String</code></li>
</ul>
</li>
<li>field access:
<ul>
<li><code>(Γ ⊢ e: C, (τ, f) ∈ Contain(C)) =&gt; Γ ⊢ e.f: τ</code></li>
<li><code>(static τ f) ∈ Contain(C) =&gt; Γ ⊢ C.f: τ</code></li>
</ul>
</li>
<li>assignment:
<ul>
<li><code>(x: τ1 in Γ, Γ ⊢ e: τ2, τ1 := τ2) =&gt; Γ ⊢ x = e: τ1</code>
<ul>
<li>&quot;τ2 is assignable to τ1&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="week-6-feb-14">Week 6. Feb 14</h1>
<p>assignability (jls sec5):</p>
<ul>
<li><code>τ := τ</code></li>
<li>widening conversions:
<ul>
<li><code>int := char</code></li>
<li><code>short := byte</code></li>
<li><code>int := byte</code></li>
<li><code>int := short</code></li>
<li>char is unsigned: 0 ~ 2^16-1</li>
<li>short is signed: -2^15 <code>~</code> 2^15-1</li>
</ul>
</li>
<li>if <code>D &lt;= C</code> then <code>C := D</code>
<ul>
<li>if <code>D &lt; C</code>, then <code>D &lt;= C</code></li>
<li><code>C &lt;= C</code></li>
<li>if <code>C1 &lt;= C2, C2 &lt;= C3</code>, then <code>C1 &lt;= C3</code></li>
</ul>
</li>
<li><code>C := NullType</code></li>
<li><code>τ[] := NullType</code></li>
<li><code>Object := τ[]</code></li>
<li><code>Clonable := τ[]</code></li>
<li><code>Serializable := τ[]</code></li>
<li>if <code>D &lt;= C</code>, then <code>C[] := D[]</code></li>
</ul>
<p><strong>eg.</strong></p>
<pre><code class="language-java">B[] bs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>[<span class="hljs-number">1</span>];
Object[] os = bs;  <span class="hljs-comment">// typechecks</span>
os[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;123&quot;</span>;     <span class="hljs-comment">// typechecks</span>
<span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> bs[<span class="hljs-number">0</span>];       <span class="hljs-comment">// runtime problem</span>
</code></pre>
<p>java: adds runtime check at every array write: throws <code>ArrayStoreException</code> on 3rd line.</p>
<p>rules (continued):</p>
<ul>
<li>assignment:
<ul>
<li><code>Γ ⊢ e1: C, Γ ⊢ e2: τ2, &quot;τ1 f&quot; in Contain(C) =&gt; Γ ⊢ e1.f = e2</code>
<ul>
<li>field access</li>
</ul>
</li>
<li><code>&quot;static τ1 f&quot; in Contain(C), Γ ⊢ e: τ2, τ1 := τ2 =&gt; Γ ⊢ C.f = e</code>
<ul>
<li>static field</li>
</ul>
</li>
</ul>
</li>
<li>array:
<ul>
<li><code>Γ ⊢ e1: τ1[], Γ ⊢ e2: τ2, num(τ2) =&gt; Γ ⊢ e1[e2]: τ1</code></li>
<li><code>Γ ⊢ e1: τ1[], Γ ⊢ e2: τ2, num(τ2), Γ ⊢ e3: τ3, τ1 := τ3 =&gt; Γ ⊢ e1[e2] = e3</code></li>
<li><code>Γ ⊢ e: τ', num(τ') =&gt; Γ ⊢ new τ[e]: τ[]</code></li>
<li><code>Γ ⊢ e: τ[] =&gt; Γ ⊢ e.length: int</code></li>
</ul>
</li>
<li>method calls:
<ul>
<li><code>Γ ⊢ e: C, Γ ⊢ e2: τ2, &quot;τ m(τ1,...,τn)&quot; in Contain(C) =&gt; Γ ⊢ e.m(e1,...,en): τ</code>
<ul>
<li>instance method</li>
</ul>
</li>
<li><code>... =&gt; Γ ⊢ C.m(e1,...,en): τ</code>
<ul>
<li>static method</li>
</ul>
</li>
</ul>
</li>
<li>casts:
<ul>
<li><code>Γ ⊢ e: τ', num(τ), num(τ') =&gt; Γ ⊢ (τ) e: τ</code></li>
<li><code>Γ ⊢ e: τ1, τ2 := τ1 =&gt; Γ ⊢ (τ2) e: τ2</code>
<ul>
<li>upcast: no runtime check</li>
</ul>
</li>
<li><code>Γ ⊢ e: τ1, τ1 := τ2 =&gt; Γ ⊢ (τ2) e: τ2</code>
<ul>
<li>downcast: need runtime check</li>
</ul>
</li>
<li><code>Γ ⊢ e: τ1, t1 is interface, τ2 is interface/nonfinal class =&gt; Γ ⊢ (τ2) e: τ2</code>
<ul>
<li>C implements J, I; wants to cast from I to J</li>
</ul>
</li>
<li><code>Γ ⊢ e: τ1, τ2 is interface, τ1 is interface or nonfinal class =&gt; Γ ⊢ (τ2) e: τ2</code></li>
</ul>
</li>
<li>instanceof:
<ul>
<li><code>Γ ⊢ e: τ1, τ2 is reference type, Γ ⊢ (τ2)e: τ2 =&gt; Γ ⊢ e instance of τ2: boolean</code></li>
</ul>
</li>
</ul>
<p>statement rules: <code>Γ; σ ⊢ S</code></p>
<ul>
<li><code>Γ; void ⊢ return;</code></li>
<li><code>Γ ⊢ e: τ, σ := τ =&gt; Γ; σ ⊢ return e;</code></li>
<li><code>Γ ⊢ e: τ', τ := τ', Γ[x-&gt;τ]; σ ⊢ S =&gt; Γ; σ ⊢ τ x = e; S</code>
<ul>
<li>[]: declare new local variable x with type τ</li>
</ul>
</li>
<li><code>Γ; σ ⊢ S =&gt; Γ; σ ⊢ {S};</code></li>
<li><code>Γ ⊢ e: boolean, Γ; σ ⊢ S1, Γ; σ ⊢ S2 =&gt; Γ; σ ⊢ if (e) S1 else S2;</code></li>
<li><code>Γ ⊢ x = e: τ, Γ; σ ⊢ x = e;</code></li>
</ul>
<h2 id="dataflow-analysis">dataflow analysis</h2>
<p>essense of type system: approximate facts/properties of runtime behavior statistically.</p>
<p><strong>eg.</strong> definitive assignment:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">f</span><span class="hljs-params">(List&lt;Integer&gt; l)</span> {
    <span class="hljs-type">int</span> x;
    <span class="hljs-keyword">try</span> {
        x = l.get(<span class="hljs-number">0</span>);
    } <span class="hljs-keyword">catch</span> (IndexoutofBoundsException e) {
        System.err.println(<span class="hljs-string">&quot;empty list&quot;</span>);
    }
    <span class="hljs-keyword">return</span> x;
}
</code></pre>
<p>this program does not typecheck in java, since <code>x</code> may not be initialized. this is observed at compile-time.</p>
<p>dataflow analysis is special case of program analysis, which includes:</p>
<ul>
<li>definite assignment (a4)</li>
<li>reachable statement analysis (a4)</li>
<li>live variable analysis (a4)</li>
<li>null pointer analysis</li>
<li>escape analysis (check if variable is only used inside a method)</li>
<li>exception analysis</li>
<li>termination analysis</li>
<li>in general these are undecidable</li>
</ul>
<h3 id="live-variable-analysis">live variable analysis</h3>
<ul>
<li>register allocation: assigning registers to program variables</li>
<li>variable x is live at some point = value x may be needed later</li>
</ul>
<p><strong>eg.</strong></p>
<pre><code class="language-java">            <span class="hljs-comment">// live = {a,e}</span>
b = a + <span class="hljs-number">2</span>;
            <span class="hljs-comment">// live = {b,e}</span>
c = b + b;
            <span class="hljs-comment">// live = {c,e}</span>
d = c * e;
            <span class="hljs-comment">// live = {d}</span>
<span class="hljs-keyword">return</span> d;
            <span class="hljs-comment">// live = {}</span>
</code></pre>
<ul>
<li>&lt;= 2 vars are live at any point =&gt; use 2 registers</li>
<li>a, b, c, d are never live together =&gt; eax; e =&gt; ecx</li>
</ul>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> y;
f();       <span class="hljs-comment">// is x is live iff f() terminates? undecidable</span>
<span class="hljs-keyword">return</span> x;
</code></pre>
<p>conservative approximation: overestimate liveness.</p>
<p>we compute facts over a <em>control-flow-graph (CFG)</em>:</p>
<p><strong>eg.</strong> consider</p>
<pre><code class="language-arm">    <span class="hljs-keyword">cmp</span> t1 t2       <span class="hljs-comment">//I1</span>
    jz l1           <span class="hljs-comment">//I2</span>
    <span class="hljs-keyword">mov</span> t3, <span class="hljs-number">42</span>      <span class="hljs-comment">//I3</span>
<span class="hljs-symbol">L1:</span> <span class="hljs-keyword">add</span> t3, t4      <span class="hljs-comment">//I4</span>
</code></pre>
<p>the CFG would be:</p>
<pre><code>I1 -&gt; I2
I2 -&gt; I3 (false)
I3 -&gt; I4
I2 -&gt; I4 (true)
</code></pre>
<p><strong>eg.</strong> consider code</p>
<pre><code class="language-java"><span class="hljs-keyword">while</span> (c) {
    x = y + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (d) {
        x = y + z;
    }
    z = <span class="hljs-number">1</span>;
}
</code></pre>
<p>the CFG would be</p>
<p><img src="assets/w6_1.PNG" alt="img"></p>
<h3 id="simple-liveness-analysis">simple liveness analysis</h3>
<p>an IR-like language:</p>
<table>
<thead>
<tr>
<th style="text-align:center">CFG node</th>
<th style="text-align:center">IR-equivalent</th>
<th style="text-align:center">use</th>
<th style="text-align:center">def</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">x &lt;- e</td>
<td style="text-align:center">move(x, e)</td>
<td style="text-align:center">vars(e)</td>
<td style="text-align:center">{x}</td>
<td style="text-align:center">write</td>
</tr>
<tr>
<td style="text-align:center">[e1] &lt;- e2</td>
<td style="text-align:center">move(mem(e1), e2)</td>
<td style="text-align:center">vars(e1) ∪ vars(e2)</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">mem address write</td>
</tr>
<tr>
<td style="text-align:center">if e</td>
<td style="text-align:center">cjump(e, l1, l2)</td>
<td style="text-align:center">vars(e)</td>
<td style="text-align:center">∅</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">start</td>
<td style="text-align:center">label(f)</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">∅</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">return e</td>
<td style="text-align:center">return(e)</td>
<td style="text-align:center">vars(e)</td>
<td style="text-align:center">∅</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>expression <code>e := e1 OP e2 | [e] | ...</code>.</p>
<p>we use <code>use[n]</code> to denote set of variables read at n, <code>def[n]</code> to denote set of variables written at n.</p>
<p><strong>eg.</strong></p>
<ul>
<li><code>use[a &lt;- b+c] = {b, c}</code></li>
<li><code>def[a &lt;- b+c] = {a}</code></li>
<li><code>use[[a] &lt;- b] = {a, b}</code></li>
<li><code>def[[a] &lt;- b] = {}</code></li>
</ul>
<p><strong>defn.</strong> variable x is live on CFG edge E if there is a path from E to a use of variable, and there is no def of x in between.</p>
<p>we also define</p>
<ul>
<li><code>in[n]</code> to be facts true on all incoming edges, or vars that may be live before n executes
<ul>
<li><code>in[n] = use[n] </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∪</mo></mrow><annotation encoding="application/x-tex">\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∪</span></span></span></span> <code>(out[n] - def[n])</code></li>
</ul>
</li>
<li><code>out[n]</code> to be facts true on all outgoing edges, or vars that may be live after n executes
<ul>
<li><code>out[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&gt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{n&#x27;&gt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>in[n']</code></li>
<li>n' &gt; n, or n &lt; n' means n' is a successor of n</li>
</ul>
</li>
</ul>
<p><strong>algo.</strong> <em>(using iterative solving to compute in[n])</em></p>
<ol>
<li>initialize <code>in[n] := ∅</code> for all n in CFG</li>
<li>repeat until no more changes to <code>in[n]</code>:
<ol>
<li>for all node n in CFG:
<ol>
<li><code>in[n] = use[n] </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∪</mo></mrow><annotation encoding="application/x-tex">\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∪</span></span></span></span> <code>(</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&gt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{n&#x27;&gt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span> <code>in[n'] - def[n])</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>correctness:</p>
<ul>
<li>equations must be satisfied on termination =&gt; partial correctness
<ul>
<li><code>in[n]</code> can only grow</li>
<li><code>in[n]</code> can only grow |V| times, where |V| is # of of vars in the program</li>
<li>terminates in O(|V||N|) time, where |N| is # of CFG nodes</li>
</ul>
</li>
</ul>
<p><strong>algo.</strong> <em>(using worklist to solve in[n])</em></p>
<ol>
<li>initialize <code>in[n] := ∅</code> for all n in CFG</li>
<li>initialize worklist <code>w :=</code> all nodes in CFG
<ul>
<li>invariant: node n's equations are not currently satisfied =&gt; n in w</li>
</ul>
</li>
<li>while w is not empty:
<ol>
<li><code>w := w - {n}</code></li>
<li><code>in[n] := use[n] </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∪</mo></mrow><annotation encoding="application/x-tex">\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∪</span></span></span></span> <code>(</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&gt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{n&#x27;&gt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span> <code>in[n'] - def[n])</code></li>
<li>if <code>in[n]</code> changed:
<ol>
<li><code>w := w </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∪</mo></mrow><annotation encoding="application/x-tex">\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∪</span></span></span></span> <code>{n': n' &lt; n}</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>correctness:</p>
<ul>
<li>invariant is proven by induction =&gt; equations are satisfied on termination =&gt; partial correctness</li>
<li>terminates O(|N||V|) time</li>
</ul>
<p><strong>eg.</strong> we can use this to detect dead assignments:</p>
<pre><code class="language-java"><span class="hljs-keyword">while</span> (z &lt; <span class="hljs-number">1000</span>) {
    <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    <span class="hljs-keyword">if</span> (z &gt; <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">return</span> y;
    } <span class="hljs-keyword">else</span> {
        y = z;
        z = z + <span class="hljs-number">1</span>;
    }
}
<span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> z;
<span class="hljs-keyword">return</span> y;
</code></pre>
<p>the statement <code>y = z</code> is a dead assignment.</p>
<p><strong>eg.</strong> by jls 14.20 all statements must potentially execute</p>
<pre><code class="language-java">f();  <span class="hljs-comment">// reachable only if f() terminates (unreachable)</span>
x = y + <span class="hljs-number">1</span>;
<span class="hljs-keyword">return</span>;
<span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">1</span>) {...}  <span class="hljs-comment">// cannot potentially execute</span>
</code></pre>
<h1 id="week-8-feb-28">Week 8. Feb 28</h1>
<h3 id="reachable-statement-analysis">reachable statement analysis</h3>
<p>the CFG will be all joos statements (same graph) + 2 synthetic nodes: start and end.</p>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-type">int</span> <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> {
    <span class="hljs-keyword">while</span> (g(x) &gt; <span class="hljs-number">0</span>) {
        S;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>the CFG is:<br>
<img src="assets/w8_1.PNG" alt="img"></p>
<p>if we change <code>while (g(x) &gt; 0)</code> to <code>while (1&gt;0)</code>, then the edge labelled F is gone. the return statement is now unreachable. if we change it to <code>while (1&lt;0)</code>, then the edge labelled T is gone, S is unreachable.</p>
<p>specially, JLS says if-else conditions are not treated as constants for reachability purposes</p>
<ul>
<li>justification: so that programmer can flip conditions for debug</li>
<li>although constant folding can be done for optimization</li>
</ul>
<p>to compute reachability, we define</p>
<ul>
<li><code>in[n]</code> = true iff program point before n may be reached
<ul>
<li><code>in[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋁</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigvee_{n&#x27;&lt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋁</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>out[n']</code></li>
<li>compiler needs to report error of <code>in[n] = false</code></li>
<li><code>in[start]</code> is always true</li>
</ul>
</li>
<li><code>out[n]</code> = true iff program point after n may be reached
<ul>
<li><code>out[n] = false</code> if n is <code>return;</code> or <code> return e;</code></li>
<li><code>out[n] = true</code> if n is start</li>
<li><code>out[n] = in[n]</code> otherwise</li>
</ul>
</li>
</ul>
<p>this is a <em>forward analysis</em> (info propagates from start node), while the liveness analysis is a <em>backward analysis</em>.</p>
<p><strong>algo.</strong> <em>(computing out[n] with iterative solving)</em></p>
<ol>
<li>initialize <code>out[n] := false</code> for all n in CFG</li>
<li>repeat until no changes to <code>out[n]</code>:
<ol>
<li><code>out[n] = </code>the formulas</li>
</ol>
</li>
</ol>
<p><strong>algo.</strong> <em>(computing out[n] with worklist)</em></p>
<ol>
<li>initialize <code>out[n] := false</code> for all n in CFG</li>
<li>set worklist <code>w :=</code> all nodes in CFG</li>
<li>while w is not empty:
<ol>
<li><code>w = w - {n}</code></li>
<li><code>out[n] = </code>the formulas</li>
<li>if <code>out[n]</code> changed:
<ol>
<li><code>w = w </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∪</mo></mrow><annotation encoding="application/x-tex">\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∪</span></span></span></span> <code>{n': n' &gt; n}</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>eg.</strong> LJS also requires if method return type is not void, then every finite execution path must return.</p>
<pre><code class="language-java"><span class="hljs-type">int</span> <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> {
    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-comment">// need to error</span>
}
</code></pre>
<p><img src="assets/w8_2.PNG" alt="img"></p>
<p>we look at <code>in[end]</code>. if it is true, then we are missing a return statement.</p>
<ul>
<li>this is because we always set out to be false for return nodes, and in[end] is the union of end's predecessors' outs.</li>
</ul>
<h3 id="available-copies-analysis">available copies analysis</h3>
<p><strong>eg.</strong></p>
<pre><code class="language-java">y = f(<span class="hljs-number">0</span>);
x = y;
...
z = <span class="hljs-number">3</span> * x;
</code></pre>
<p>we can know <code>y</code> is copied over to the assignment of <code>z</code>. then we can convert the code to</p>
<pre><code class="language-java">y = f(<span class="hljs-number">0</span>);
...
z = <span class="hljs-number">3</span> * y;
</code></pre>
<p>define some auxiliary functions:</p>
<table>
<thead>
<tr>
<th style="text-align:left">n</th>
<th style="text-align:center"><code>gen[n]</code></th>
<th style="text-align:center"><code>kill[n]</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">x &lt;- y</td>
<td style="text-align:center">{x=y}</td>
<td style="text-align:center">{∀z:x=z} ∪ {∀z:z=x}</td>
</tr>
<tr>
<td style="text-align:left">x &lt;- e</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">{∀z:x=z} ∪ {∀z:z=x}</td>
</tr>
<tr>
<td style="text-align:left">[e1] &lt;- e2</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">∅</td>
</tr>
<tr>
<td style="text-align:left">if e</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">∅</td>
</tr>
<tr>
<td style="text-align:left">return</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">∅</td>
</tr>
<tr>
<td style="text-align:left">start</td>
<td style="text-align:center">∅</td>
<td style="text-align:center">all available copies</td>
</tr>
</tbody>
</table>
<p>define</p>
<ul>
<li><code>in[n] = </code>available copies before n executes (<code>{x1=y1, ..., xn=yn}</code>)
<ul>
<li><code>in[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋂</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcap_{n&#x27;&lt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋂</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>out[n']</code></li>
</ul>
</li>
<li><code>out[n] = </code>available copies after n executes
<ul>
<li><code>out[n] = gen[n] ∪ (in[n] - kill[n])</code></li>
</ul>
</li>
</ul>
<p>this is also a forward analysis, we can use same worklist algo.</p>
<h3 id="dataflow-analysis-framework">dataflow analysis framework</h3>
<p>in summary:</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">top</th>
<th style="text-align:left">transfer function</th>
<th style="text-align:left">meet operator</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LVA (backward)</td>
<td style="text-align:left">∅</td>
<td style="text-align:left"><code>in[n] = use[n] ∪ (out[n] - def[n])</code></td>
<td style="text-align:left"><code>out[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&gt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{n&#x27;&gt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>in[n']</code></td>
</tr>
<tr>
<td style="text-align:left">RSA (forward)</td>
<td style="text-align:left">false</td>
<td style="text-align:left"><code>out[n] = ...</code></td>
<td style="text-align:left"><code>in[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋁</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigvee_{n&#x27;&lt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋁</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>out[n']</code></td>
</tr>
<tr>
<td style="text-align:left">ACA (forward)</td>
<td style="text-align:left">all copies</td>
<td style="text-align:left"><code>out[n] = gen[n] ∪ (in[n] - kill[n])</code></td>
<td style="text-align:left"><code>in[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋂</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcap_{n&#x27;&lt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋂</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>out[n']</code></td>
</tr>
</tbody>
</table>
<p>dataflow analysis framework:</p>
<ul>
<li>L = space of facts (dataflow values)
<ul>
<li>for LVA, it is set of live vars</li>
<li>for RSA, it is true/false</li>
<li>for ACA, it is set of available copies</li>
<li>ℓ ∈ L: fact about a program point in CFG</li>
</ul>
</li>
<li>direction = forward or backward</li>
<li>how CFG nodes transform the facts:
<ul>
<li>forward: <code>out[n] = Fn(in[n])</code></li>
<li>backward: <code>in[n] = Fn(out[n])</code></li>
</ul>
</li>
<li>meet operator ∏:
<ul>
<li>forward: <code>in[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∏</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\prod_{n&#x27;&lt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>out[n']</code></li>
<li>backward: <code>out[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∏</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&gt;</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\prod_{n&#x27;&gt;n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>in[n']</code></li>
</ul>
</li>
<li>top element in L: maximal info in the space of facts
<ul>
<li>is the least conservative option</li>
</ul>
</li>
</ul>
<p>the worklist algo does not specify in which order to remove n from worklist, so it can be inefficient if CFG has cycles.</p>
<ul>
<li>we can first find all strongly connected components in the CFG, then do a topo sort on the SCCs</li>
<li>so we can do a single traversal in this order =&gt; more efficient</li>
<li>there might still be cycles in SCCs, but they are smaller</li>
</ul>
<p><strong>algo.</strong> <em>(iterative solving for forward analysis)</em></p>
<ol>
<li>initialize <code>out[n] := top</code> for all n in CFG</li>
<li>repeat until convergence:
<ol>
<li>for each node n:
<ol>
<li><code>out[n] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>n</mi></msub><mrow><mo fence="true">(</mo><msub><mo>∏</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>≺</mo><mi>n</mi></mrow></msub><mtext mathvariant="monospace">out[n’]</mtext><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_n\left(\prod_{n&#x27;\prec n}\texttt{out[n&#x27;]}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">≺</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord texttt">out[n’]</span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="iterative-solving">iterative solving</h3>
<p>claim: iterative approximation = computing a fixed point.</p>
<p>given N nodes in CFG, start from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>T</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo><mo>∈</mo><msup><mi>L</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">(T,T,...,T)\in L^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span>, result is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><msub><mi>n</mi><mn>1</mn></msub></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><msub><mi>n</mi><mi>N</mi></msub></msub><mo stretchy="false">)</mo><mo>∈</mo><msup><mi>L</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">(\ell_{n_1},...,\ell_{n_N})\in L^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0003em;vertical-align:-0.2503em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2503em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span>. we use a single transfer function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>:</mo><msup><mi>L</mi><mi>N</mi></msup><mo>→</mo><msup><mi>L</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">F:L^N\to L^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span> with</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><msub><mi>n</mi><mn>1</mn></msub></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><msub><mi>n</mi><mn>2</mn></msub></msub><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">(</mo><msub><mi>F</mi><msub><mi>n</mi><mn>1</mn></msub></msub><mrow><mo fence="true">(</mo><munder><mo>∏</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>≺</mo><msub><mi>n</mi><mn>1</mn></msub></mrow></munder><msub><mi mathvariant="normal">ℓ</mi><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>F</mi><msub><mi>n</mi><mi>N</mi></msub></msub><mrow><mo fence="true">(</mo><munder><mo>∏</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>≺</mo><msub><mi>n</mi><mi>N</mi></msub></mrow></munder><msub><mi mathvariant="normal">ℓ</mi><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(\ell_{n_1},...,\ell_{n_2})=\left(F_{n_1}\left(\prod_{n&#x27;\prec n_1}\ell_{n&#x27;}\right),...,F_{n_N}\left(\prod_{n&#x27;\prec n_N}\ell_{n&#x27;}\right)\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-0.2501em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1443em;vertical-align:-1.3943em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.856em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">≺</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3941em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2503em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.856em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">≺</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3943em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span></span></span></p>
<p><strong>algo.</strong> <em>(iterative solving)</em></p>
<ol>
<li>init <code>X := (T, ..., T)</code></li>
<li>repeat until convergence:
<ol>
<li><code>X = F(X)</code></li>
</ol>
</li>
</ol>
<p>we need some conditions to ensure convergence and correctness:</p>
<p><strong>claim.</strong> L must be a <em>partial order</em> (a set with a binary relation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo></mrow><annotation encoding="application/x-tex">\leq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≤</span></span></span></span>)</p>
<ul>
<li>satisfies relations:
<ul>
<li>reflexive: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">ℓ</mi><mo>≤</mo><mi mathvariant="normal">ℓ</mi></mrow><annotation encoding="application/x-tex">\ell\leq\ell</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord">ℓ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">ℓ</span></span></span></span></li>
<li>transitive: if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\ell_2\leq\ell_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>antisymmetric: if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\ell_2\leq\ell_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>=</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1=\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> means <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is at least as informative as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>
<ul>
<li>LVA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>⊆</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\subseteq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>RSA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">true</mtext><mo>≤</mo><mtext mathvariant="monospace">false</mtext><mo separator="true">,</mo><mtext mathvariant="monospace">false</mtext><mo>≤</mo><mtext mathvariant="monospace">false</mtext><mo separator="true">,</mo><mtext mathvariant="monospace">true</mtext><mo>≤</mo><mtext mathvariant="monospace">true</mtext></mrow><annotation encoding="application/x-tex">\texttt{true}\leq\texttt{false},\texttt{false}\leq\texttt{false},\texttt{true}\leq\texttt{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord text"><span class="mord texttt">true</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord texttt">false</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord texttt">false</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord texttt">false</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord texttt">true</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5536em;"></span><span class="mord text"><span class="mord texttt">true</span></span></span></span></span></li>
<li>ACA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>⊆</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\subseteq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
</ul>
<p><strong>eg.</strong> for any set S, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mn>2</mn><mi>S</mi></msup><mo separator="true">,</mo><mo>⊆</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2^S,\subseteq)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span> is a partial order.<br>
we can use hasse diagram for S={a,b,c} case:</p>
<p><img src="assets/w8_3.PNG" alt="img"></p>
<p>the height is 3.</p>
<p><strong>eg.</strong> if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>L</mi><mo separator="true">,</mo><mo>≤</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(L,\leq)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span> is partial order, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>L</mi><mo separator="true">,</mo><mo>≥</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(L,\geq)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span> is also a partial order.</p>
<p><strong>claim.</strong> L must be a <em>lower semilattice</em> (partial order + GLB operator <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊓</mo></mrow><annotation encoding="application/x-tex">\sqcap</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">⊓</span></span></span></span>).</p>
<ul>
<li>+two requirements
<ol>
<li>lower bound: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>⊓</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>⊓</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ell_1\sqcap\ell_2\leq \ell_1,\ell_1\sqcap\ell_2\leq\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊓</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊓</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>greater: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><msub><mi mathvariant="normal">ℓ</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><mn>3</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>∧</mo><msub><mi mathvariant="normal">ℓ</mi><mn>3</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><msub><mi mathvariant="normal">ℓ</mi><mn>3</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>⊓</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\forall \ell_3,\ell_3\leq\ell_1\land\ell_3\leq\ell_2\implies\ell_3\leq\ell_1\sqcap\ell_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">∀</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊓</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ol>
</li>
<li>LVA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊓</mo><mo>=</mo><mo>∪</mo></mrow><annotation encoding="application/x-tex">\sqcap=\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">⊓</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∪</span></span></span></span>; RSA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊓</mo><mo>=</mo><mo>∨</mo></mrow><annotation encoding="application/x-tex">\sqcap=\vee</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">⊓</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∨</span></span></span></span>; ACA: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊓</mo><mo>=</mo><mo>∩</mo></mrow><annotation encoding="application/x-tex">\sqcap=\cap</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">⊓</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∩</span></span></span></span></li>
</ul>
<p><strong>claim.</strong> <em>(condition 1)</em>: L must be a bounded lower semilattice (lower semilattice + top element).</p>
<ul>
<li>+requirement on T: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi mathvariant="normal">ℓ</mi><mo>∈</mo><mi>L</mi><mo separator="true">,</mo><mi mathvariant="normal">ℓ</mi><mo>≤</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">\forall\ell\in L,\ell\leq T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord">∀</span><span class="mord">ℓ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">ℓ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span></li>
</ul>
<p><strong>notation.</strong></p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo>≤</mo><mo stretchy="false">(</mo><msubsup><mi mathvariant="normal">ℓ</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msubsup><mi mathvariant="normal">ℓ</mi><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\ell_1,...,\ell_N)\leq(\ell_1&#x27;,...,\ell_N&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mi>i</mi></msub><mo>≤</mo><msubsup><mi mathvariant="normal">ℓ</mi><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">\ell_i\leq\ell_i&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span> for all i</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo>⊓</mo><mo stretchy="false">(</mo><msubsup><mi mathvariant="normal">ℓ</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msubsup><mi mathvariant="normal">ℓ</mi><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>⊓</mo><msubsup><mi mathvariant="normal">ℓ</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">ℓ</mi><mi>n</mi></msub><mo>⊓</mo><msubsup><mi mathvariant="normal">ℓ</mi><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\ell_1,...,\ell_N)\sqcap(\ell_1&#x27;,...,\ell_N&#x27;)=(\ell_1\sqcap\ell_1&#x27;,...,\ell_n\sqcap\ell_N&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊓</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊓</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊓</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∈</mo><msup><mi>L</mi><mi>N</mi></msup><mo>=</mo><mo stretchy="false">(</mo><mi>T</mi><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T\in L^N=(T,...,T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></li>
</ul>
<p><strong>claim.</strong> if L is PO/semilattice/bounded semilattice, then so is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>L</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">L^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>the iterative solving then says given <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>0</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mi>T</mi><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X_0=(T,...,T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span>, we have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msup><mi>F</mi><mn>2</mn></msup><mo stretchy="false">(</mo><msub><mi>X</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>=</mo><msup><mi>F</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><msub><mi>X</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X_{i+1}=F(X_i)=F^2(X_{i-1})=...=F^{i+1}(X_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0747em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>. if it converges in k-th iteration, then we should have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mi>k</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>X</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">X_{k+1}=F(X_k)=X_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p><strong>eg.</strong> L={true, false}, &lt;= is not more informative, F(l)=¬l. what if we apply iterative solving? it never converges. so we need more condition on tranfer function.</p>
<p><strong>claim.</strong> <em>(condition 2)</em> F must be <em>monotone</em>, ie <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo>≤</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>F</mi><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>≤</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\ell_1\leq\ell_2\implies F(\ell_1)\leq F(\ell_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</p>
<p><strong>eg.</strong> <code>Fn(l) = use[n] ∪ (l - def[n])</code> is monotone. it is also true <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>:</mo><msup><mi>L</mi><mi>N</mi></msup><mo>→</mo><msup><mi>L</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">F:L^N\to L^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span> is also monotone.</p>
<p><strong>eg.</strong> suppose we want to find the fixed point of transfer function F.</p>
<p><img src="assets/w8_4.PNG" alt="img"></p>
<p>we first apply F to x0, then apply F to x1 and so on until we approach a fixed point xk. our algo then terminates.</p>
<p>what if we have a transfer function that is not bounded below:</p>
<p><img src="assets/w8_5.PNG" alt="img"></p>
<p>it will descend forever.</p>
<p><strong>claim.</strong> <em>(condition 3)</em>  L must be of finite height.</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">ℓ</mi><mn>0</mn></msub><mo>&gt;</mo><msub><mi mathvariant="normal">ℓ</mi><mn>1</mn></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>&gt;</mo><msub><mi mathvariant="normal">ℓ</mi><mi>k</mi></msub><mo>&gt;</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\ell_0&gt;\ell_1...&gt;\ell_k&gt;...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.1056em;"></span><span class="mord">...</span></span></span></span></li>
<li>L has height h =&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>L</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">L^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span> has height Nh.</li>
</ul>
<p>we can use this to prove termination of iterative solving. if we know <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>X</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">X_1\leq X_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then by transitivity and condition 2 we know <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>2</mn></msub><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>≤</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>X</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>X</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">X_2=F(X_1)\leq F(X_0)=X_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>... using inductive argument we can prove that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>≤</mo><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X_{i+1}\leq X_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> for all i. by condition 3, there must exist a k such that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>0</mn></msub><mo>≥</mo><msub><mi>X</mi><mn>1</mn></msub><mo>≥</mo><msub><mi>X</mi><mi>k</mi></msub><mo>=</mo><msub><mi>X</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">X_0\geq X_1\geq X_k=X_{k+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span> where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≤</mo><mi>N</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">k\leq Nh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">h</span></span></span></span>.</p>
<p>so blindly applying the transfer function Nh times we will get a fixed point.</p>
<p>next we want to show <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mrow><mi>N</mi><mi>h</mi></mrow></msup><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F^{Nh}(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span> is the greatest fix point, ie <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>X</mi><mo>≤</mo><msup><mi>F</mi><mrow><mi>N</mi><mi>h</mi></mrow></msup><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X=F(X)\implies X\leq F^{Nh}(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span>. we know <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>≤</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">X\leq T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>≤</mo><mi>F</mi><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>≤</mo><msup><mi>F</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>≤</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>≤</mo><msup><mi>F</mi><mrow><mi>N</mi><mi>h</mi></mrow></msup><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X=F(X)\leq F(T)\leq F^2(T)\leq...\leq F^{Nh}(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span>.</p>
<p>in summary, if L is bonded lower semilattice + top + finite height, F is monotone, then iterative solving will give best fixed point in Nh iterations.</p>
<h1 id="week-9-mar-7">Week 9. Mar 7</h1>
<h2 id="ir">IR</h2>
<p>source -&gt; AST (with optimization) -&gt; IR (can have high level IR, middle level IR, low level IR) -&gt; machine code</p>
<p>IR design goals</p>
<ul>
<li>simplicity</li>
<li>language independence</li>
<li>machine independence</li>
<li>support optimization + codegen</li>
</ul>
<p>approaches:</p>
<ol>
<li>low-level AST IR with mem ops and jumps (TIR, appel's)</li>
<li>stack-based IR (JUM, wasm)
<ul>
<li>easy to generate code/interpret IR code</li>
<li>harder to do optimizations (less like asm language)</li>
</ul>
</li>
<li><em>3-address code</em>. quadruples (llvm)
<ul>
<li><code>x1 &lt;- x2 op x3</code></li>
<li>no subexpressions =&gt; easier to do analysis</li>
<li>harder to do intruction selection</li>
</ul>
</li>
<li><em>A-norm</em> ≈ 3addr code + higher order control
<ul>
<li>pass lambda around</li>
<li>(functional languages)</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:right">TIR</th>
<th style="text-align:center">IR node type</th>
<th style="text-align:center">abbreviation</th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>Expression e ::=</code></td>
<td style="text-align:center"><code> CONST(n)</code></td>
<td style="text-align:center"><code>n</code></td>
<td style="text-align:left">literal(any type)</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>TEMP(t)</code></td>
<td style="text-align:center"><code>t</code></td>
<td style="text-align:left">assume infinite supply of temps</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>OP(e1, e2)</code></td>
<td style="text-align:center"><code>e1 op e2</code></td>
<td style="text-align:left">binary op</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>MEM(e)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left">memory at</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>CALL(</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>f</mi></msub><mo separator="true">,</mo><mover accent="true"><mi>e</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">e_f,\vec{e}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">e</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">e_f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> is addr of code</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>NAME(l)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left">l is a code/data label</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>ESEQ(s, e)</code></td>
<td style="text-align:center"><code>s;e</code></td>
<td style="text-align:left">do statement s, then evaluate e</td>
</tr>
<tr>
<td style="text-align:right"><code>OP ::=</code></td>
<td style="text-align:center"><code>ADD|MUL|SUB|DIV</code><br/><code>MOD|AND|OR|XOR</code><br/><code>NOT|RSH|LSH|ASH</code><br/><code>EQ|NEQ|LT|GT</code><br/><code>LE|GE</code></td>
<td style="text-align:center"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:right"><code>Statement S ::=</code></td>
<td style="text-align:center"><code>MOVE(</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mtext>dst</mtext></msub><mo separator="true">,</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">e_{\text{dst}},e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dst</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span></span></span></span><code>)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mtext>dst</mtext></msub></mrow><annotation encoding="application/x-tex">e_{\text{dst}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dst</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><code> ::= TEMP(t) | MEM(e)</code></td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>EXP(e)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left">evaluate e, discard result</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>SEQ(</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>)</code></td>
<td style="text-align:center"><code>s1;...sn;</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>JUMP(e)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left">e is address</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>CJUMP(e, l1, l2)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left">eval e, if 0 then jump to l1, else to l2</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>LABEL(l)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left">naming current program point</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:center"><code>RETURN(e)</code></td>
<td style="text-align:center"></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>interpreting TIR: post-order traversal on IR AST except at c|jump/call/return.</p>
<ul>
<li><code>/u/cs444/pub/tir</code></li>
</ul>
<h3 id="translating-from-source-language-to-ir">translating from source language to IR</h3>
<p>we have two mutually recursive functions:</p>
<ul>
<li><code>E[[e]] = e'</code>: takes source expression and returns IR expressions</li>
<li><code>S[[S]] = S'</code>: takes source statement and returns IR statement</li>
</ul>
<p>expression:</p>
<ul>
<li><code>E[[n]] = CONST(n)</code></li>
<li><code>E[[true]] = CONST(1)</code></li>
<li><code>E[[false]] = CONST(0)</code></li>
<li><code>E[[e1 + e2]] = OP(E[[e1]], E[[e2]])</code></li>
<li><code>E[[x]] = TEMP(x)</code></li>
<li><code>E[[f(e1, ..., en)]] = CALL(NAME(f), E[[e1]], ..., E[[en]])</code></li>
</ul>
<p>translating function:</p>
<pre><code class="language-scala"><span class="hljs-type">F</span>[[τ f(τ<span class="hljs-number">1</span> x1, ..., τn xn) {s}]] =
  <span class="hljs-type">LABEL</span>(f);
  <span class="hljs-type">MOVE</span>(<span class="hljs-type">TEMP</span>(x1), <span class="hljs-type">TEMP</span>(<span class="hljs-type">ARG1</span>));
  ...
  <span class="hljs-type">MOVE</span>(<span class="hljs-type">TEMP</span>(xn), <span class="hljs-type">TEMP</span>(<span class="hljs-type">ARGn</span>));
  <span class="hljs-type">S</span>[[s]];
</code></pre>
<p>statements:</p>
<ul>
<li><code>S[[int x = e;]] = MOVE(TEMP(x), E[[e]])</code></li>
<li><code>S[[s1; ...; sn]] = SEQ(S[[s1]], ..., S[[sn]])</code></li>
<li><code>S[[if(e) s]] = SEQ(CJUMP(E[[e]], lt, lf); LABEL(lt); S[[s]]; LABEL(lf))</code>
<ul>
<li>shorthand:<pre><code class="language-scala"><span class="hljs-type">CJUMP</span>(<span class="hljs-type">E</span>[[e]], lt, lf);
lt: <span class="hljs-type">S</span>[[s]];  ; fresh labels
lf:
</code></pre>
</li>
</ul>
</li>
<li><code>S[[return e]] = RETURN(E[[e]])</code></li>
</ul>
<p>logical and (with shortcircuit):</p>
<pre><code class="language-scala"><span class="hljs-type">E</span>[[e1 &amp;&amp; e2]] = <span class="hljs-comment">/*ESEQ(SEQ(*/</span>
  <span class="hljs-type">MOVE</span>(t, <span class="hljs-number">0</span>);
  <span class="hljs-type">CJUMP</span>(<span class="hljs-type">E</span>[[e1]], lt, lf);
  lt: <span class="hljs-type">MOVE</span>(t, <span class="hljs-type">E</span>[[e2]]);
  lf:<span class="hljs-comment">/*)*/</span> <span class="hljs-type">TEMP</span>(t)<span class="hljs-comment">/*;)*/</span>
</code></pre>
<p><strong>eg.</strong> how to translate <code>S[[if (e1 &amp;&amp; e2) s]]</code>? can compose two translations above</p>
<pre><code class="language-scala"><span class="hljs-type">CJUMP</span>(<span class="hljs-type">ESEQ</span>(<span class="hljs-type">SEQ</span>(...), <span class="hljs-type">TEMP</span>(t)), lt, lf)
lt: ...
lf: ...
</code></pre>
<p>there are fragmented branches =&gt; inefficient. we can do</p>
<pre><code class="language-scala"><span class="hljs-type">CJUMP</span>(<span class="hljs-type">E</span>[[e1]], l, lf);
l: <span class="hljs-type">CJUMP</span>(<span class="hljs-type">E</span>[[e2]], lt, lf);
lt: <span class="hljs-type">S</span>[[s]]
lf: ...
</code></pre>
<p>we define <code>C[[e, lt, lf]] =</code> IR stmt that jumps to lt if e is nonzero:</p>
<ul>
<li><code>C[[true, lt, lf]] = JUMP(lt)</code></li>
<li><code>C[[false, lt, lf]] = JUMP(lf)</code></li>
<li><code>C[[!e, lt, lf]] = C[[e, lf, lt]]</code></li>
<li>
<pre><code class="language-scala"><span class="hljs-type">C</span>[[e1 &amp;&amp; e2, lt, lf]] =
  <span class="hljs-type">C</span>[[e1, l, lf]];
  l: <span class="hljs-type">C</span>[[e2, lt, lf]]
</code></pre>
</li>
<li>
<pre><code class="language-scala"><span class="hljs-type">C</span>[[e1 || e2, lt, lf]] =
  <span class="hljs-type">C</span>[[e1, lt, l]];
  l: <span class="hljs-type">C</span>[[e2, lt, lf]]
</code></pre>
</li>
</ul>
<p>when we have this, then we can easily translate the if statement:</p>
<pre><code class="language-scala"><span class="hljs-type">S</span>[[<span class="hljs-keyword">if</span> (e) <span class="hljs-type">S</span>]] =
    <span class="hljs-type">C</span>[[e, lt, lf]]
    lt: <span class="hljs-type">S</span>[[<span class="hljs-type">S</span>]]
    lf: ...
</code></pre>
<p>translating while:</p>
<pre><code class="language-scala"><span class="hljs-type">C</span>[[<span class="hljs-keyword">while</span> (e) s]] =
  lw: <span class="hljs-type">C</span>[[e, lt, lf]]
    lt: <span class="hljs-type">S</span>[[s]]
        <span class="hljs-type">JUMP</span>(lw)
    lf: ...
</code></pre>
<h3 id="arrays">arrays</h3>
<p>we represent arrays as sequence of 4-byte words</p>
<pre><code>int[] a = new int[n];

+-----------+
|  length   |
+-----------+
|  vtable   | &lt;- TEMP(a)
+-----------+
|   a[0]    |
+-----------+
|   ....    |
+-----------+
|  a[n-1]   |
+-----------+
</code></pre>
<p>translating indexing:</p>
<pre><code class="language-scala"><span class="hljs-type">E</span>[[e1[e2]]] =
  <span class="hljs-type">MOVE</span>(ta, <span class="hljs-type">E</span>[[e1]])
  <span class="hljs-type">CJUMP</span>(<span class="hljs-type">EQ</span>(ta, <span class="hljs-number">0</span>), l_err, l_nn)  <span class="hljs-comment">// check for null</span>
  l_err: <span class="hljs-type">CALL</span>(<span class="hljs-type">NAME</span>(__exception)) <span class="hljs-comment">// lib function</span>
  l_nn: <span class="hljs-type">MOVE</span>(ti, <span class="hljs-type">E</span>[[e2]])
  <span class="hljs-type">CJUMP</span>(<span class="hljs-type">LTU</span>(ti, <span class="hljs-type">MEM</span>(ta - <span class="hljs-number">4</span>)), l_ib, l_err)  <span class="hljs-comment">// unsigned lt</span>
  l_lb: <span class="hljs-type">MEM</span>(ta + ti * <span class="hljs-number">4</span> + <span class="hljs-number">4</span>)
</code></pre>
<p>translating assignment to array element:</p>
<pre><code class="language-scala"><span class="hljs-type">E</span>[[e1[e2] = e3]] =
  <span class="hljs-type">MOVE</span>(ta, <span class="hljs-type">E</span>[[e1]])
  <span class="hljs-comment">// check for null</span>
  <span class="hljs-type">MOVE</span>(ti, <span class="hljs-type">E</span>[[e2]])
  <span class="hljs-comment">// check for bounds</span>
  <span class="hljs-type">MOVE</span>(te, <span class="hljs-type">E</span>[[e3]])
  <span class="hljs-type">MOVE</span>(<span class="hljs-type">MEM</span>(ta + ti * <span class="hljs-number">4</span> + <span class="hljs-number">4</span>), te)
  te
</code></pre>
<p>translating new array:</p>
<pre><code class="language-scala"><span class="hljs-type">E</span>[[<span class="hljs-keyword">new</span> int[e]]] =
  <span class="hljs-type">MOVE</span>(tn, <span class="hljs-type">E</span>[[e]])
  <span class="hljs-comment">// check nonnegative</span>
  <span class="hljs-type">MOVE</span>(tm, <span class="hljs-type">CALL</span>(<span class="hljs-type">NAME</span>(__malloc), tn * <span class="hljs-number">4</span> + <span class="hljs-number">8</span>))
  <span class="hljs-type">MOVE</span>(<span class="hljs-type">MEM</span>(tm), tn)  <span class="hljs-comment">// store length</span>
  <span class="hljs-type">MOVE</span>(<span class="hljs-type">MEM</span>(tm + <span class="hljs-number">4</span>), ...)  <span class="hljs-comment">// store vtable</span>
  <span class="hljs-comment">// loop to store arr elements which are 0-initialized</span>
  <span class="hljs-type">TEMP</span>(tm + <span class="hljs-number">4</span>)
</code></pre>
<h3 id="ir-lowering">IR lowering</h3>
<p>what are different from assembly:</p>
<ul>
<li>deep trees of nested expressions/statements =&gt; &gt;=1 side effects per statement</li>
<li>calls as expressions</li>
<li>two-way jumps</li>
</ul>
<p>plan:</p>
<ol>
<li>flatten all SEQs and ESEQs into a toplevel SEQ
<ul>
<li>no nested statements</li>
<li>expr cannot have side effects</li>
<li>one side effect per statement</li>
</ul>
</li>
<li>CALLs become statements</li>
<li>CJUMP's false branch becomes fall through</li>
</ol>
<p>we will have lowered IR:</p>
<pre><code class="language-scala">code ::= <span class="hljs-type">SEQ</span>(s1, ..., sn)
   s ::= <span class="hljs-type">MOVE</span>(e_dst, e)   e_dst ::= <span class="hljs-type">MEM</span>(e) | <span class="hljs-type">TEMP</span>(t)
         <span class="hljs-type">JUMP</span>(e)
         <span class="hljs-type">CJUMP</span>(e, l)  <span class="hljs-comment">// deal later</span>
         <span class="hljs-type">LABEL</span>(l)
         <span class="hljs-type">RETURN</span>(e)
         <span class="hljs-type">CALL</span>(e_f, ...e)
   e ::= <span class="hljs-type">CONST</span>(n) | <span class="hljs-type">TEMP</span>(t) | <span class="hljs-type">OP</span>(e1, e2) | <span class="hljs-type">MEM</span>(e) | <span class="hljs-type">NAME</span>(l)
</code></pre>
<p>we have function:</p>
<ul>
<li><code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code> (TIR expr =&gt; LIR stmt and a pure LIR expr)
<ul>
<li>pure: either const, temp or label</li>
<li>we separate side effects and results</li>
</ul>
</li>
<li><code>L[[S]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9609em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9609em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2469em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> (TIR stmt =&gt; LIR stmt)</li>
</ul>
<p>translating statements:</p>
<ul>
<li><code>L[[LABEL(l)]] = LABEL(l)</code></li>
<li><code>L[[SEQ(s1, ..., sn)]] = L[[s1]]; ...; L[[sn]]</code></li>
<li><code>L[[JUMP(e)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>; JUMP(e')</code> given <code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code></li>
<li><code>L[[CJUMP(e, l1, l2)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>; CJUMP(e', l1, l2)</code> given <code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code></li>
<li><code>L[[EXP(e)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> given <code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code></li>
<li><code>L[[RETURN(e)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>; RETURN(e')</code> given <code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code></li>
</ul>
<p>expressions:</p>
<ul>
<li><code>L[[e]] = |e</code> if e is pure</li>
<li><code>L[[MEM(e)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | MEM(e')</code> given <code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code></li>
<li><code>L[[ESEQ(s, e)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9609em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9609em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2469em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>; </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>s</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s&#x27;&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9609em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9609em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2469em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code> given <code>L[[s]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>s</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9609em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9609em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2469em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> and <code>L[[e]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>s</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s&#x27;&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9609em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9609em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2469em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e'</code></li>
<li><code>L[[OP(e1, e2)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>1</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code> | OP(e1', e2')</code> given <code>L[[e1]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>1</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code> | e1'</code> and <code>L[[e2]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code> | e2'</code>
<ul>
<li>use only if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> and <code>e1'</code> commute</li>
</ul>
</li>
<li><code>L[[OP(e1, e2)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>1</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; MOVE(tm, e1'); </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; | OP(t, e2')</code>
<ul>
<li>fallback rule</li>
</ul>
</li>
<li><code>L[[CALL(e0, e1, ..., en)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>0</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; MOVE(t0, e0'); ...; </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mi>n</mi></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; MOVE(tn, en'); CALL(t0, t1, ..., tn); TEMP(ret)</code> given <code>L[[ei]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mi>i</mi></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code> | ei'</code> for all i
<ul>
<li>ret ~ eax</li>
</ul>
</li>
</ul>
<p>translating move:</p>
<ul>
<li><code>L[[MOVE(TEMP(t), e2)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code>; MOVE(t, e2')</code> given <code>L[[e2]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><code> | e2'</code></li>
<li><code>L[[MOVE(MEM(e1), e2)]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>1</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; MOVE(t, e1'); </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code>; MOVE(MEM(t), e2')</code> given <code>L[[e1]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>1</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code> | e1'</code> and <code>L[[e2]] = </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><code> | e2'</code></li>
</ul>
<p>when can we know side effects in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> cannot affect <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">e_1&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>?</p>
<ul>
<li>if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> assigns into temp that is read by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">e_1&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> writes <code>TEMP(t3)</code> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">e_1&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span> reads <code>TEMP(t4)</code>, only check t3 != t4</li>
</ul>
</li>
<li>if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> assigns into mem read by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">e_1&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>s</mi><mn>2</mn></msub><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> writes <code>MEM(t3)</code> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">e_1&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span> reads <code>MEM(t4)</code>. whether e3 and e4 are same address is undecidable</li>
<li>heuristics:
<ul>
<li>e3 and e4 are translations of joos expressions of different types</li>
<li><code>e_3 = t + n, e_4 = t + m</code> where immediates n != m</li>
<li>generally want pointer analysis &amp; SMT solver</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="week-10-mar-14">Week 10. Mar 14</h1>
<h3 id="canonicalizing-cjumps">canonicalizing cjumps</h3>
<p>one idea: <code>CJUMP(e, l1, l2) = CJUMP(e, l1); JUMP(l2)</code></p>
<ul>
<li>more jumps =&gt; code is inefficient</li>
</ul>
<p>new idea: reorder code so that l2 is always next statement</p>
<p>need to introduce new concepts:</p>
<ul>
<li>ordinary statement: <code>-&gt; S -&gt; S'</code></li>
<li>jump statement:<pre><code>-&gt; jump -&gt; S'
    |
    v
   ...
</code></pre>
</li>
<li>return statement<pre><code>-&gt; ret    S'
</code></pre>
</li>
<li>labels:<pre><code>-&gt; l: -&gt; S'
   ^
   |
  ...
</code></pre>
</li>
</ul>
<p><strong>defn.</strong> a <em>basic block</em> is a sequence of statements <code>s1, ..., sn</code> such that:</p>
<ul>
<li>all but <code>s1, sn</code> are ordinary statements</li>
<li><code>s1</code> can be orinary or jump statement</li>
<li><code>sn</code> can be ordinary or jump/ret statement</li>
</ul>
<p>basic block either executes fully or not at all.</p>
<p>a <em>maximal basic block</em> is a basic block that cannot be extended to a larger basic block.</p>
<p><strong>defn.</strong> the <em>trace</em> in a CFG is sequentially distinct basic blocks.</p>
<p><strong>algo.</strong> <em>(greedy reordering)</em></p>
<ol>
<li>init all blocks as unmarked</li>
<li>repeat until all blocks are marked:
<ol>
<li>choose an unmarked block</li>
<li>mark a maximal unmarked trace from the block</li>
<li>append blocks in this trace to output (while fixing/simplifying jumps)
<ol>
<li>delete jumps to next bb</li>
<li>invert cjumps as needed; drop arg</li>
<li>append jump to bb as needed</li>
<li>delete unneeded labels</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>eg.</strong> given</p>
<pre><code class="language-scala">l0:  <span class="hljs-type">CJUMP</span>(e, l2, l3)
l1:  <span class="hljs-type">MOVE</span>(x, y)
l2:  <span class="hljs-type">MOVE</span>(x, y + z)
     <span class="hljs-type">JUMP</span>(l1)
l3:  <span class="hljs-type">CALL</span>(f)
     <span class="hljs-type">RETURN</span>
</code></pre>
<p>we build a CFG on this where vertices are basic blocks:</p>
<pre><code>l0 -&gt; l2 &lt;-&gt; l1
   \
    v
    l3
</code></pre>
<p><code>l0-&gt;l2-&gt;l1</code>, <code>l1-&gt;l2</code>, <code>l0-&gt;l3</code> are traces.</p>
<p>consider <code>l0-&gt;l2-&gt;l1</code>, steps:</p>
<ol>
<li>delete <code>jump(l1)</code></li>
<li>invert top <code>cjump</code></li>
<li>add jump below l1</li>
</ol>
<p>then we do 2nd iteration to handle unmarked <code>l3</code></p>
<pre><code class="language-diff"><span class="hljs-deletion">- l0: CJUMP(e, l2, l3)</span>
<span class="hljs-addition">+ l0: CJUMP(!e, l3)</span>
  l2: MOVE(x, y + z)
<span class="hljs-deletion">-     JUMP(l1)</span>
  l1: MOVE(x, y)
<span class="hljs-addition">+     JUMP(l2)</span>

  l3: CALL(f)
      RETURN
</code></pre>
<p>heuristics for picking traces:</p>
<ul>
<li>prefer traces without unmarked predecessor</li>
<li>perfer hot code and hot edges
<ul>
<li>profiling</li>
<li>back edges (loops) take priority over forward edges</li>
</ul>
</li>
<li>ML models</li>
</ul>
<h2 id="instruction-selection">instruction selection</h2>
<p>we generate almost assembly code except we assume there are infinitely many registers.</p>
<p>steps:</p>
<ol>
<li>cover AST with tiles</li>
<li>add abstract registers between tiles</li>
<li>emit code bottom-up</li>
</ol>
<p><strong>eg.</strong> instruction selection as tiling</p>
<pre><code class="language-scala"><span class="hljs-type">MOVE</span>(t1, t1 + <span class="hljs-type">MEM</span>(t2 + <span class="hljs-number">8</span>))
</code></pre>
<p><img src="assets/w10_1.PNG" alt="img"></p>
<p>result:</p>
<pre><code class="language-arm"><span class="hljs-symbol">move</span> t3, t2
<span class="hljs-comment">;</span>
<span class="hljs-keyword">mov</span> t4, t3
<span class="hljs-keyword">add</span> t4, <span class="hljs-number">8</span>
<span class="hljs-comment">;</span>
<span class="hljs-symbol">move</span> t5, [t4]
<span class="hljs-comment">;</span>
<span class="hljs-keyword">add</span> t1, t5
</code></pre>
<p>the whole tree can be viewed as one tile, and we get</p>
<pre><code class="language-arm"><span class="hljs-keyword">add</span> t1, [t2 + <span class="hljs-number">8</span>]
</code></pre>
<p>questions:</p>
<ul>
<li>what instructions are there?</li>
<li>what can be a tile (pattern to match ast)?</li>
<li>how to select tiles?</li>
</ul>
<h3 id="x86-isa">x86 ISA</h3>
<pre><code>intel 4040    -&gt;    intel 8080    -&gt;    intel i386    -&gt;    amd64
- 8bit addr         - 16bit addr        - 32bit addr        - 64bit addr
                    - 8 8bit gpr        - 8 32bit gpr       - 16 64bit gpr
</code></pre>
<p>2-address usc isa:</p>
<ul>
<li>instruction has form <code>opcode dest, src[, src]</code> (intel syntax)</li>
<li>opcodes: <code>and, or, xor, not, shr, shl, sar, add, sub, mul, div, inc, dec, cmp, test, mov, push, pop, call, ret, ...</code></li>
<li>general purpose registers: <code>eax, ebx, ecx, edx, esi, edi, esp, ebp</code>
<ul>
<li>for the first four registers, the [8:0] bits can be accessed as <code>al, bl, cl, dl</code>, the [15:8] bits can be accessed as <code>ah, bh, ch, dh</code>, the [31:16] bits can be accessed as <code>ax, bx, cx, dx</code></li>
<li><code>esp</code> is reserved as stack pointer</li>
</ul>
</li>
<li>operands
<ul>
<li>const: <code>17</code> (<code>CONST(17)</code>)</li>
<li>reg: <code>eax</code> (<code>TEMP(eax)</code>)</li>
<li>mem addr: <code>[eax + ebx * 4 - 3]</code> (<code>MEM(eax + ebx * 4 - 3)</code>)
<ul>
<li>in general: addr is base + index * scale + offset
<ul>
<li>base, index are registers, scale is 1, 2, 4, 8, offset is const</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>size inference and directives</p>
<pre><code class="language-arm"><span class="hljs-keyword">add</span> eax, [ebx]  <span class="hljs-comment">// inferred as 32 bit</span>
<span class="hljs-symbol">inc</span> dword [ebx] <span class="hljs-comment">// need to specify (byte-8, word-16, dword-32)</span>
</code></pre>
<p>only one memory operand is allowed per instruction.</p>
<p>branching instruction:</p>
<pre><code class="language-arm"><span class="hljs-keyword">cmp</span> ebx, ecx
<span class="hljs-symbol">jz</span> l1  <span class="hljs-comment">// if condition code is zero, jump to l1 </span>
<span class="hljs-symbol">je</span> l1  <span class="hljs-comment">// equal</span>
<span class="hljs-symbol">jl</span> l1  <span class="hljs-comment">// less (also jnge)</span>
<span class="hljs-symbol">jnz</span> l1
</code></pre>
<p>condition codes are set by <code>cmp, test, xor, ...</code> and tested by <code>jcc/setcc</code>.</p>
<pre><code class="language-arm"><span class="hljs-symbol">setz</span> al <span class="hljs-comment">// set lower 8 bit</span>
</code></pre>
<p>tiling is not syntax-direct translation, but pattern matching.</p>
<p>we define</p>
<ul>
<li><code>T[[e]] t = </code> instruction sequence that puts result of IR expression e into assembly register t</li>
<li><code>T[[s]] = </code> instruction sequence that computes IR statement s</li>
</ul>
<p>some patterns:</p>
<ul>
<li><code>T[[MOVE(t, 0)]] = mov t, 0</code> or <code>xor t, t</code></li>
<li><code>T[[ADD(t1, t2)]] t3 = lea t3, [t1 + t2]</code></li>
<li><code>T[[ADD(k, ADD(e1, MUL(e2, w)))]] t =</code>  where w=1,2,4,8<pre><code class="language-arm">T[[e1]] t1
T[[e2]] t2
<span class="hljs-symbol">lea</span> t, [t1 + t2 * w + k]
</code></pre>
</li>
<li><code>T[[EQ(e1, e2))] t =</code><pre><code class="language-arm">T[[e1]] t1
T[[e2]] t2
<span class="hljs-keyword">cmp</span> t1, t2
<span class="hljs-symbol">setz</span> al
<span class="hljs-symbol">movzx</span> t, eax <span class="hljs-comment">// clears high bits of eax &amp; move eax to t</span>
</code></pre>
</li>
<li><code>T[[CJUMP(e, l)]] =</code><pre><code class="language-arm">T[[e]] t
<span class="hljs-symbol">test</span> t, t
<span class="hljs-symbol">jnz</span> l
</code></pre>
</li>
<li><code>T[[CJUMP(EQ(e1, e2), l)]] =</code><pre><code class="language-arm">T[[e1]] t1
T[[e2]] t2
<span class="hljs-keyword">cmp</span> t1, t2
<span class="hljs-symbol">jz</span> l
</code></pre>
</li>
</ul>
<p>tiling algorithms:</p>
<p><strong>algo.</strong> <em>(greedy)</em>: choose tiles greedily by priority size of tile</p>
<ol>
<li>match root if ir ast with highest-priority matching tile</li>
<li>recursively match subtrees</li>
</ol>
<p><strong>eg.</strong><br>
<img src="assets/w10_2.PNG" alt="img"></p>
<p>the result is</p>
<pre><code class="language-arm"><span class="hljs-keyword">mov</span> t1, [t2 + <span class="hljs-number">8</span>]
<span class="hljs-keyword">mov</span> t2, [t + <span class="hljs-number">7</span>]
<span class="hljs-keyword">mov</span> [t1 + t2 * <span class="hljs-number">4</span>], <span class="hljs-number">3</span>
</code></pre>
<p>good: no search =&gt; fast. bad: not optimal.</p>
<p>assume there is a notion of optimality: cost of tiling a tree using a tile = cost of the tile + cost of tiling the subtrees, we also can have bellman equations:</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mrow><mi>t</mi><mi>i</mi><mi>l</mi><mi>e</mi></mrow></munder><mrow><mo fence="true">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mi>i</mi><mi>l</mi><mi>e</mi><mo stretchy="false">)</mo><mo>+</mo><munder><mo>∑</mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>t</mi><msup><mi>r</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mtext> is subtree of </mtext><mi>t</mi><mi>r</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mtext> after covering with tile</mtext></mstyle></mtd></mtr></mtable></mstyle></munder><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><msup><mi>r</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{cost}(tr)=\min_{tile}\left(\mathrm{cost}(tile)+\sum_{\substack{tr&#x27;\text{ is subtree of }tr\\\text{ after covering with tile}}}\mathrm{cost}(tr&#x27;)\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">cost</span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.3479em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7521em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.875em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='4.800em' viewBox='0 0 875 4800'><path d='M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,1284c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-1292c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">cost</span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.4951em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1984em;"><span style="top:-3.1984em;"><span class="pstrut" style="height:2.8278em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord text mtight"><span class="mord mtight"> is subtree of </span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-2.3239em;"><span class="pstrut" style="height:2.8278em;"></span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight"> after covering with tile</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6984em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1437em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">cost</span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.875em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='4.800em' viewBox='0 0 875 4800'><path d='M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,1209
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-1344c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><strong>algo.</strong> <em>(dynamic programming)</em></p>
<ol>
<li>use optimal tiling if memoized already</li>
<li>for each tile matching the root of tree
<ol>
<li>recursively tile subtrees</li>
<li>compute cost of tiling</li>
</ol>
</li>
<li>memoize best tiling and its cost</li>
</ol>
<p>runtime: O(nt) where n is # of nodes in tree and t is # of matching tiles.</p>
<p>pros and cons:</p>
<ul>
<li>+ general strategy for optimizing tiling</li>
<li>- expensive</li>
<li>- need a cost model</li>
</ul>
<p>goals:</p>
<ul>
<li>completeness =&gt; cover all asts</li>
<li>efficiency =&gt; leverage ISA (mem operand, rich addressing modes)</li>
</ul>
<p>strategy:</p>
<ul>
<li>first syntax-directed tiles</li>
<li>then add tiles to improve code quality</li>
</ul>
<h3 id="tiling-callreturn">tiling call/return</h3>
<p>an x86 <code>call f</code> is roughly equivalent to</p>
<pre><code class="language-arm"><span class="hljs-keyword">sub</span> esp, <span class="hljs-number">4</span>
<span class="hljs-keyword">mov</span> [esp], eip  <span class="hljs-comment">// push return addr onto stack</span>
<span class="hljs-symbol">jmp</span> f
</code></pre>
<p>calling convention:</p>
<ul>
<li>cdecl (mainstream for x86)</li>
<li>first push arguments to stack in reverse order and return address</li>
<li>then result is returned in eax</li>
</ul>
<pre><code>before call                 pushing                 during call
           higher addr
|         |   ^           |          |             |           |
|         |   |           |          |             |           |
+---------+               +----------+             |           |
|         |  &lt; esp        |          |             |           |
+---------+               +----------+             |           |
|         |               |   arg2   |             |           |
|         |               |   arg1   |             +-----------+
|         |   |           |caller eip| &lt; esp       |caller ebp |
|         |   v           +----------+             +-----------+        ^
|         |stack grows    |          |             |   temp    |        | L
                                                   |  storage  | &lt; esp  |
                                                   +-----------+        v
</code></pre>
<pre><code class="language-scala"><span class="hljs-type">T</span>[[<span class="hljs-type">CALL</span>(f, e1, ..., en); <span class="hljs-type">MOVE</span>(t, <span class="hljs-type">RET</span>)]] =
  <span class="hljs-type">T</span>[[en]] tn
  push tn     <span class="hljs-comment">//   sub esp, 4</span>
              <span class="hljs-comment">//   mov [esp], t</span>
  ...
  <span class="hljs-type">T</span>[[e1]] t1
  push t1
  call f
  mov t, eax
  add esp, <span class="hljs-number">4</span> * n
</code></pre>
<p>function prologue:</p>
<pre><code class="language-arm"><span class="hljs-keyword">push</span> ebp
<span class="hljs-keyword">mov</span> ebp, esp
<span class="hljs-keyword">sub</span> esp, <span class="hljs-number">4</span> * L  <span class="hljs-comment">// temps at [ebp-4*i]</span>
</code></pre>
<p>function epilogue:</p>
<pre><code class="language-arm"><span class="hljs-keyword">mov</span> esp, ebp
<span class="hljs-keyword">pop</span> ebp       <span class="hljs-comment">// mov t, [esp]</span>
              <span class="hljs-comment">// add esp, 4</span>
<span class="hljs-symbol">ret</span>
</code></pre>
<p>caller-vs-callee-saved registers:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">caller</th>
<th style="text-align:center">callee</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">caller-saved</td>
<td style="text-align:center">must save value on stack<br/>restore after call</td>
<td style="text-align:center">can use freely</td>
</tr>
<tr>
<td style="text-align:center">callee-saved</td>
<td style="text-align:center">can use freely</td>
<td style="text-align:center">must save value on stack<br/>restore before return</td>
</tr>
</tbody>
</table>
<ul>
<li>caller-saved: eax, ecx, edx</li>
<li>callee-saved: esp, ebp, ebx, esi, edi</li>
</ul>
<p>constant-size frame optimization</p>
<ul>
<li><code>ebp = esp + 4*L</code> =&gt; can avoid using ebp, ie <code>[ebp + k] = [esp + k + 4 * L]</code></li>
<li>prologue: <code>sub esp, 4 * L</code></li>
<li>epilogue: <code>add esp, 4 * L; ret</code></li>
<li>dynamic stack allocation is not allowed</li>
</ul>
<p><strong>eg.</strong> C vla:</p>
<pre><code class="language-arm"><span class="hljs-comment">// int a[f()];</span>
<span class="hljs-symbol">call</span> f
<span class="hljs-symbol">shl</span> eax, <span class="hljs-number">2</span>
<span class="hljs-keyword">sub</span> esp, eax
<span class="hljs-keyword">mov</span> a, esp
</code></pre>
<h1 id="week-11-mar-21">Week 11. Mar 21</h1>
<h3 id="register-spilling">register spilling</h3>
<p>idea: put all abstract registers on stack, and access them using [ebp-4], [ebp-8], ...</p>
<p>observations: any given x86 instructions uses at most 3 registers =&gt; we reserve 3 registers.</p>
<p><strong>eg.</strong></p>
<pre><code class="language-arm"><span class="hljs-keyword">push</span> t
<span class="hljs-comment">// translates to (t maps to ecx)</span>
<span class="hljs-keyword">mov</span> ecx, [ebp - kt]
<span class="hljs-keyword">push</span> ecx
</code></pre>
<pre><code class="language-arm"><span class="hljs-keyword">mov</span> a, [<span class="hljs-keyword">b</span> + <span class="hljs-number">8</span>]
<span class="hljs-comment">// translates to (a maps to ecx, b maps to edx)</span>
<span class="hljs-keyword">mov</span> edx, [ebp - kb]
<span class="hljs-keyword">mov</span> ecx, [edx + <span class="hljs-number">8</span>]
<span class="hljs-keyword">mov</span> [ebp - ka], ecx
</code></pre>
<pre><code class="language-arm"><span class="hljs-keyword">add</span> x, y
<span class="hljs-comment">// translates to (x maps to ecx, y maps to edx)</span>
<span class="hljs-keyword">mov</span> ecx, [ebp - kx]
<span class="hljs-keyword">mov</span> edx, [ebp - ky]
<span class="hljs-keyword">add</span> ecx, edx
<span class="hljs-keyword">mov</span> [ebp - kx], ecx
</code></pre>
<pre><code class="language-arm"><span class="hljs-keyword">sub</span> [x + d * y + <span class="hljs-number">31</span>], z
<span class="hljs-comment">// translates to (x maps to ecx, y maps to edx, z maps to eax)</span>
<span class="hljs-keyword">mov</span> eax, [ebp - kz]
<span class="hljs-keyword">mov</span> ecx, [ebp - kx]
<span class="hljs-keyword">mov</span> edx, [ebp - ky]
<span class="hljs-keyword">sub</span> [ecx + <span class="hljs-number">8</span> * edx + <span class="hljs-number">31</span>], eax
</code></pre>
<h2 id="compiling-oo-features">compiling OO features</h2>
<p>memory layout:</p>
<ul>
<li>fields placed sequentially</li>
<li>fields aligned to not cross word boundary</li>
<li>instruction pointers to methods are stored in dispatch vector</li>
</ul>
<p><strong>eg.</strong> in cpp</p>
<pre><code class="language-cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CPP</span> {
    <span class="hljs-type">short</span> x;    <span class="hljs-comment">// 16 bits</span>
    <span class="hljs-type">char</span> y;     <span class="hljs-comment">// 8 bits</span>
    CPP *next;  <span class="hljs-comment">// 32 bits</span>
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CPP</span>() {}
}
</code></pre>
<p>memory:</p>
<pre><code>MSB        LSB
+-----------+
|  header   |
+--+--+-----+
|  |y |  x  |
+--+--+-----+
|    next   |
+-----------+
</code></pre>
<p><strong>eg.</strong> in joos</p>
<pre><code class="language-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Joos</span> {
    <span class="hljs-type">short</span> x;    <span class="hljs-comment">// 16 bits</span>
    <span class="hljs-type">char</span> y;     <span class="hljs-comment">// 16 bits</span>
    Joos next;  <span class="hljs-comment">// 32 bits</span>
}
</code></pre>
<p>memory:</p>
<pre><code>+-----------+         +-----------+
|  header   |         |  header   |
+-----+-----+         +-----+-----+
|  y  |  x  |   or    |     |  x  |
+-----+-----+         +-----+-----+
|    next   |         |     |  y  |
+-----------+         +-----+-----+
                      |    next   |
                      +-----------+
</code></pre>
<p>constructors: compiled like static methods except it allocates memory. &quot;this&quot; points to newly allocated memory.</p>
<h3 id="method-dispatch">method dispatch</h3>
<p>method dispatch: compiled as function with extra argument for receiver</p>
<p>goals:</p>
<ul>
<li>fast dispatch</li>
<li>low per-object overhead</li>
<li>code sharing (seperate compilation)</li>
</ul>
<p>idea 1: smalltalk</p>
<ul>
<li>objects points to 'class objects'</li>
<li>on a call, walk up class hierarchy, find first matching method in class object</li>
<li>pros: code sharing</li>
<li>cons: slow</li>
</ul>
<p>idea 2: attach <em>dispatch vectors</em> (array of code pointers) to objects</p>
<ul>
<li>pros: fast dispatch, code sharing, low per-object overhead</li>
<li>cons: only works for single inheritance</li>
</ul>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-type">int</span> x, y;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setX</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> { <span class="hljs-built_in">this</span>.x = x; }
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">moveX</span><span class="hljs-params">(<span class="hljs-type">int</span> dx)</span> { <span class="hljs-built_in">this</span>.setX(x + dx); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ColoredPoint</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Point</span> {
    Color c;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setX</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> {
        <span class="hljs-built_in">this</span>.x = x;
        c = Colors.redden(c);
    }
    Color <span class="hljs-title function_">getColor</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> c; }
}

<span class="hljs-type">Point</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ColoredPoint</span>();
p.setX(<span class="hljs-number">42</span>);  <span class="hljs-comment">// p gets redder</span>
p.moveX(<span class="hljs-number">1</span>);  <span class="hljs-comment">// p gets more redder</span>
</code></pre>
<pre><code>Point:
+-----------+      +-------------+
|  header  -------&gt;|    setX() -----------&gt; Point:setX()
+-----------+      +-------------+
|    x      |      |    moveX() ----------&gt; Point:moveX() &lt;--+
+-----------+      +-------------+                           |
|    y      |                                                |
+-----------+                                                |
                                                             |
ColoredPoint:                                                |
+-----------+      +-------------+                           |
|  header  -------&gt;|    setX() -----------&gt; CP:setX()        |
+-----------+      +-------------+                           |
|    x      |      |    moveX() -----------------------------+
+-----------+      +-------------+
|    y      |      |  getColor() ---------&gt; CP:getColor()
+-----------+      +-------------+
|    c      |
+-----------+
</code></pre>
<p>observatation: Point is a prefix of ColorPoint (prefix) =&gt; compiler can treat a ColorPoint as a Point =&gt; achieving code sharing.</p>
<pre><code class="language-arm"><span class="hljs-comment">// p.moveX(1)</span>
<span class="hljs-symbol">MOVE</span>(T_DV, MEM(p))
<span class="hljs-symbol">CALL</span>(MEM(T_DV + <span class="hljs-number">4</span>), p, <span class="hljs-number">1</span>)
<span class="hljs-comment">// translates to</span>
<span class="hljs-keyword">mov</span> tdv, [p]
<span class="hljs-keyword">push</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">push</span> p
<span class="hljs-symbol">call</span> [tdv + <span class="hljs-number">4</span>]
</code></pre>
<p>field access is done by offseting from object pointer</p>
<pre><code class="language-arm"><span class="hljs-comment">// p.x</span>
<span class="hljs-symbol">MEM</span>(p + <span class="hljs-number">4</span>)
</code></pre>
<p><strong>note.</strong> for abstract classes, we do not need DV for instance, but still need DV layout and compiled code for non-abstract method.</p>
<p>code for assmebly:</p>
<pre><code class="language-arm"><span class="hljs-comment">// Point.s</span>
<span class="hljs-symbol">section</span> <span class="hljs-meta">.text</span>
<span class="hljs-symbol">global</span> Point$$setX$I
<span class="hljs-symbol">Point$$setX$I:</span>
    ...
<span class="hljs-symbol">global</span> Point$$moveX$I
<span class="hljs-symbol">Point$$moveX$I:</span>
    ...
<span class="hljs-symbol">global</span> Point$$$
<span class="hljs-symbol">Point$$$:</span>
    ...

<span class="hljs-comment">// vtable for Point</span>
<span class="hljs-symbol">section</span> <span class="hljs-meta">.data</span>
<span class="hljs-symbol">global</span> Point
<span class="hljs-symbol">Point:</span>
<span class="hljs-symbol">extern</span> java$lang$Object$$getClass$
<span class="hljs-symbol">dd</span> java$lang$Object$$getClass$  <span class="hljs-comment">// define dword at first 32 bits</span>
<span class="hljs-symbol">extern</span> java$lang$Object$$clone$
<span class="hljs-symbol">dd</span> java$lang$Object$$clone$     <span class="hljs-comment">// next 32 bits</span>
<span class="hljs-symbol">extern</span> java$lang$Object$$hashCode$
<span class="hljs-symbol">dd</span> java$lang$Object$$hashCode$
<span class="hljs-symbol">extern</span> java$lang$Object$$toString$
<span class="hljs-symbol">dd</span> java$lang$Object$$toString$
<span class="hljs-symbol">extern</span> java$lang$Object$$equals$Ljava.lang.Object
<span class="hljs-symbol">dd</span> java$lang$Object$$equals$Ljava.lang.Object
<span class="hljs-symbol">dd</span> Point$$setX$I
<span class="hljs-symbol">dd</span> Point$$moveX$I
</code></pre>
<pre><code class="language-arm"><span class="hljs-comment">// ColoredPoint.s</span>
<span class="hljs-symbol">section</span> <span class="hljs-meta">.text</span>
<span class="hljs-symbol">global</span> ColoredPoint$$getColor$
<span class="hljs-symbol">ColoredPoint$$getColor$:</span>
    ...
<span class="hljs-symbol">global</span> ColoredPoint$$setX$I
<span class="hljs-symbol">ColoredPoint$$setX$I:</span>
    ...
<span class="hljs-symbol">global</span> ColoredPoint$$$
<span class="hljs-symbol">ColoredPoint$$$:</span>
    ...

<span class="hljs-symbol">section</span> <span class="hljs-meta">.data</span>
<span class="hljs-symbol">global</span> ColoredPoint
<span class="hljs-symbol">ColoredPoint:</span>
<span class="hljs-symbol">extern</span> java$lang$Object$$getClass$
<span class="hljs-symbol">dd</span> java$lang$Object$$getClass$
<span class="hljs-symbol">extern</span> java$lang$Object$$clone$
<span class="hljs-symbol">dd</span> java$lang$Object$$clone$
<span class="hljs-symbol">extern</span> java$lang$Object$$hashCode$
<span class="hljs-symbol">dd</span> java$lang$Object$$hashCode$
<span class="hljs-symbol">extern</span> java$lang$Object$$toString$
<span class="hljs-symbol">dd</span> java$lang$Object$$toString$
<span class="hljs-symbol">extern</span> java$lang$Object$$equals$Ljava.lang.Object
<span class="hljs-symbol">dd</span> java$lang$Object$$equals$Ljava.lang.Object
<span class="hljs-symbol">dd</span> ColoredPoint$$setX$I
<span class="hljs-symbol">extern</span> Point$$moveX$I
<span class="hljs-symbol">dd</span> Point$$moveX$I
<span class="hljs-symbol">dd</span> ColoredPoint$$getColor$
</code></pre>
<p>what does java do: support dynamic loading of classes =&gt; no guarantee code is compiled</p>
<ul>
<li>jvm computes offsets at load time</li>
</ul>
<pre><code>java:     cp.getColor()
               |   javac
               v
bytecode: invokeVirtual &quot;CP.getColor&quot;
               |   java
               v
          invokeVirtualQuick 2
            /               \ only 1 version (final)
jit:       v                 v
     mov tdv, [cp]         call getColor directly/inline
       ...
     call [tdv + 2 * 4]
</code></pre>
<h3 id="interfaces">interfaces</h3>
<p>problem: class/interface can extend &gt;= 1 interfaces and 1 class.</p>
<p>we have colliding method offsets</p>
<pre><code>                    I1   DV = {a()}
                   /  \
                  /    \
DV = {a(), b()}  I2    I3 DV = {a(), c()}
                  \    /
                   \  /
                    C4 DV = {a(), b? c?}
</code></pre>
<p>idea 1: inline caching</p>
<ul>
<li>used by smalltalk</li>
<li>insight: 90% of calls at call site go to same code</li>
<li>use cache in global data</li>
<li>assume line 444 has code <code>o.m()</code><pre><code>        |       |
ld444   |     -----&gt; last class of o seen
code444 |     -----&gt; last method m called
        |       |
</code></pre>
</li>
<li>the calling sequence is<pre><code class="language-arm"><span class="hljs-symbol">L444:</span> <span class="hljs-keyword">mov</span> tid, [o]  <span class="hljs-comment">// assume o points to class id, then fields</span>
      <span class="hljs-keyword">cmp</span> tid, [id444]
      jne miss444
      call [code444]
<span class="hljs-symbol">done444:</span> ...
<span class="hljs-symbol">miss444:</span>
      call slowDispatch
      <span class="hljs-keyword">mov</span> [id444], tid
      <span class="hljs-keyword">mov</span> [code444], methodptr
      jmp done444
</code></pre>
</li>
<li>cons: thread safety
<ul>
<li>thread-local cache (has cost)</li>
<li>pack id and code pointer into single word</li>
</ul>
</li>
<li>widely used in dynamic languages</li>
</ul>
<p>polymorphic inline caching: 2-4 entires of cache</p>
<p>idea 2: assign indices to not collide</p>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Color</span> {
    RGB <span class="hljs-title function_">rgb</span><span class="hljs-params">()</span>;
    HSV <span class="hljs-title function_">hsv</span><span class="hljs-params">()</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Clickable</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">click</span><span class="hljs-params">()</span>;

}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Shape</span> {
    Box <span class="hljs-title function_">bounds</span><span class="hljs-params">()</span>;
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Graphics</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span>, Color {
    Box <span class="hljs-title function_">bounds</span><span class="hljs-params">()</span>;
    RGB <span class="hljs-title function_">rgb</span><span class="hljs-params">()</span>;
    HSV <span class="hljs-title function_">hsv</span><span class="hljs-params">()</span>;
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span>, Clickable {
    Box <span class="hljs-title function_">bounds</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">click</span><span class="hljs-params">()</span>;
}
</code></pre>
<p>if we assign <code>0: rgb, 1: hsv, 2: click, 3: bounds</code>, then we have wasted fields but they are compatible</p>
<pre><code>Graphics DV: {rgb(), hsv(), 0, bounds()}
Button DV: {0, 0, click(), bounds()}
</code></pre>
<p>we can be smarter to assign <code>1: rgb, 2: hsv, 1: click, 0: bounds</code>, then we have densely packed DVs</p>
<pre><code>Graphics DV: {bounds(), rgb(), hsv()}
button DV: {bounds(), click()}
</code></pre>
<p>observation: two methods conflict if they are present in same class =&gt; can draw interference graphs</p>
<ul>
<li>graph coloring = assigning indices</li>
<li>it is np-complete =&gt; can use heuristics</li>
<li>always can increase DV size</li>
</ul>
<pre><code>              rgb
             /  |
click -- bounds |
             \  |
              hsv
</code></pre>
<p>this approach requires whole-program info =&gt; cannot do seperate compilation.</p>
<p>idea3: compute indices by hashing</p>
<p><strong>eg.</strong></p>
<pre><code class="language-java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PointI</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setX</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">moveX</span><span class="hljs-params">(<span class="hljs-type">int</span> dx)</span>;
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PointI</span> {
    <span class="hljs-type">int</span> x, y;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setX</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">moveX</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Colored</span> {
    Color <span class="hljs-title function_">getColor</span><span class="hljs-params">()</span>;
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ColoredPoint</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Point</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Colored</span> {
    Color c;
    Color <span class="hljs-title function_">getColor</span><span class="hljs-params">()</span>;
}
</code></pre>
<ul>
<li>IDT ~ hash table</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi>X</mi></mrow></msub></mrow><annotation encoding="application/x-tex">h_{setX}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">se</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">tX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> := precomputed hash for <code>PointI.setX</code> shared by all classes implementing <code>PointI</code></li>
</ul>
<p><img src="assets/w11_1.PNG" alt="img"></p>
<p>calling sequence:</p>
<pre><code class="language-arm"><span class="hljs-comment">// PointI p = ColoredPoint();</span>
<span class="hljs-comment">// p.setX(6);</span>
<span class="hljs-symbol">MOVE</span>(t_CDV, MEM(p))
<span class="hljs-symbol">MOVE</span>(t_IDT, MEM(t_CDV))
<span class="hljs-symbol">MOVE</span>(t_setX, AND(h_setX, MEM(t)IDT))  <span class="hljs-comment">// effectively h_setX = h_setX % 2^N</span>
<span class="hljs-symbol">CALL</span>(MEM(t_IDT + <span class="hljs-number">4</span> * t_setX + <span class="hljs-number">4</span>), id_setX, p, <span class="hljs-number">6</span>)  <span class="hljs-comment">// pass method id in case of collision</span>

<span class="hljs-keyword">mov</span> t_CDV, [p]
<span class="hljs-keyword">mov</span> t_IDT, [t_CDV]
<span class="hljs-keyword">mov</span> t_setX, h_setX
<span class="hljs-keyword">and</span> t_setX, [t_IDT]
<span class="hljs-keyword">push</span> <span class="hljs-number">6</span>
<span class="hljs-keyword">push</span> p
<span class="hljs-keyword">push</span> id_setX
<span class="hljs-symbol">call</span> [t_IDT + <span class="hljs-number">4</span> * t_setX + <span class="hljs-number">4</span>]
</code></pre>
<p>to dispatch interface methods, we need 8 instructions whereas for method we need 4.</p>
<ul>
<li>first load also mostly like leads to cache miss (other three are shared objects)</li>
</ul>
<p>tension: size N vs. hash collision rate</p>
<h3 id="instanceof">instanceof</h3>
<pre><code class="language-java">o <span class="hljs-keyword">instanceof</span> C;
<span class="hljs-type">C</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> (c)o;
arr[i] = o;
</code></pre>
<p>idea1: use CDV as class identity; store in CDV a pointer to parent's CDV</p>
<pre><code class="language-arm"><span class="hljs-symbol">EQ</span>(MEM(o), t_CDV(C)) <span class="hljs-title">||</span>
<span class="hljs-symbol">EQ</span>(MEM(MEM(o)), t_CDV(C)) <span class="hljs-title">||</span>
<span class="hljs-symbol">...</span>
</code></pre>
<ul>
<li>pros: caching; seperate compilation</li>
<li>cons: linear search for single inheritance, tree search for multiple inheritance</li>
</ul>
<p>idea 2: assume class hierarchy depth &lt;= 4,</p>
<ul>
<li>reserve N words in CDV</li>
<li>ith slot points to ith ancestor</li>
</ul>
<p><img src="assets/w11_2.PNG" alt="img"></p>
<p>calling sequence:</p>
<pre><code class="language-arm"><span class="hljs-comment">// o instanceof Ci (assume Ci is ith class in C&#x27;s hierarchy)</span>
<span class="hljs-symbol">EQ</span>(MEM(t_CDV(Ak) + <span class="hljs-number">4</span> * i), t_CDV(Ci))
</code></pre>
<ul>
<li>+ O(1) time</li>
<li>- O(MN) space where M is height of hierarchy and N is number of classes</li>
<li>- need to know N</li>
<li>- no multiple inheritance support</li>
</ul>
<p>idea 3: use a global M*M table where M = number of types</p>
<ul>
<li>Ti is a suptype of Tj iff <code>table[i][j]</code></li>
<li>+ O(1) time</li>
<li>+ works for multiple inheritance</li>
<li>- O(M^2) space</li>
<li>- need to know M</li>
</ul>
<h1 id="week-12-mar-28">Week 12. Mar 28</h1>
<h2 id="register-allocation">register allocation</h2>
<p><strong>eg.</strong></p>
<pre><code class="language-arm">                 <span class="hljs-comment">// live analysis</span>
                 <span class="hljs-comment">// a</span>
<span class="hljs-keyword">mov</span> b, a         <span class="hljs-comment">// b, a</span>
<span class="hljs-keyword">mov</span> c, [<span class="hljs-keyword">b</span> * <span class="hljs-number">4</span>]   <span class="hljs-comment">// c, a</span>
<span class="hljs-symbol">lea</span> b, [c + <span class="hljs-number">1</span>]   <span class="hljs-comment">// a, b</span>
<span class="hljs-keyword">mov</span> d, a         <span class="hljs-comment">// b, d</span>
<span class="hljs-symbol">imul</span> d, <span class="hljs-keyword">b</span>        <span class="hljs-comment">// d</span>
<span class="hljs-keyword">mov</span> eax, d       <span class="hljs-comment">// eax</span>
<span class="hljs-symbol">ret</span>              <span class="hljs-comment">//</span>
</code></pre>
<p>we create CFG and use live var analysis backwards to get live sets.</p>
<p>obersavation: we have low register pressure:</p>
<ul>
<li>&lt;= 2 vars are live simultaneously</li>
<li>a, d are never live at same time</li>
<li>b, c are never live at same time</li>
</ul>
<p>so we substitute a, b with eax; b, c with edx:</p>
<pre><code class="language-arm"><span class="hljs-keyword">mov</span> edx, eax
<span class="hljs-keyword">mov</span> edx, [edx * <span class="hljs-number">4</span>]
<span class="hljs-symbol">lea</span> edx, [edx + <span class="hljs-number">1</span>]
<span class="hljs-comment">// mov eax, eax</span>
<span class="hljs-symbol">imul</span> eax, edx
<span class="hljs-comment">// mov eax, eax</span>
<span class="hljs-symbol">ret</span>
</code></pre>
<p>observation:</p>
<ul>
<li>if two vars are in the same live-out set, then they cannot be assigned to same register</li>
<li>we can coalesce <code>mov</code>s</li>
<li>some regs are def'ed by instruction and var live-out from same instruction =&gt; cannot be assigned to same register
<ul>
<li>eg. <code>imul t</code> multiplies <code>eax</code> and <code>t</code> and stores result in <code>edx</code> and <code>eax</code> =&gt; cannot assign <code>edx</code> to <code>t</code> even if it may be trashed</li>
</ul>
</li>
</ul>
<p>register allocation = graph coloring</p>
<ul>
<li>draw interference graph</li>
<li>vertices: vars &amp; machine registers</li>
<li>edges: interference</li>
</ul>
<pre><code>c  ----  a  ----  b  ----  d
red     blue     red      blue
</code></pre>
<p>graph coloring is np-complete:</p>
<ul>
<li>we can use heuristics</li>
<li>allowed to fail =&gt; still spill vars to stack</li>
</ul>
<p>kempe's heuristic:</p>
<ul>
<li>suppose k colors are available</li>
<li>low-degree nodes (&lt; k neighbours): rest of graph colorable =&gt; node must be colorable</li>
<li>high-degree nodes (&gt;= neighbours): no such guarantee</li>
</ul>
<p><strong>algo.</strong> <em>(kempe)</em></p>
<ol>
<li>if theare are &lt;= k nodes in graph, then we are done</li>
<li>if there exists low-degree node
<ol>
<li>color rest of graph recursively</li>
<li>pick a color different from &lt; k neighbours of this node</li>
</ol>
</li>
</ol>
<p><strong>eg.</strong> k = 3</p>
<pre><code>    b
  / | \
a   |  d
  \ | / \
    c -- e
</code></pre>
<p>first we exclude a and color rest of graph, then we exclude b and color the rest, then we color c,d,e with different colors (say c=blue, d=yellow, e= green). then we color b=green, a=yellow.</p>
<p>if there are no low-deg nodes, graph may or may not be colorable (eg K4 vs planar graph of 5 nodes).</p>
<p><strong>algo.</strong> <em>(optimistic coloring)</em></p>
<ol>
<li>if theare are &lt;= k nodes in graph, then we are done</li>
<li>if there exists low-degree node
<ol>
<li>color rest of graph recursively</li>
<li>pick a color different from &lt; k neighbours of this node</li>
</ol>
</li>
<li>otherwise:
<ol>
<li>pick a high-degree node</li>
<li>color rest of graph recursively</li>
<li>try to find a color that works</li>
<li>spill vars to stack if failure</li>
</ol>
</li>
</ol>
<p>how to spill:</p>
<ul>
<li>perviously, we use 3 regs for shuffling things on/off stack, which increases reg pressure.</li>
<li>we can spill with fresh abstract regs and retry reg allocation</li>
</ul>
<p><strong>eg.</strong> suppose we have to spil t2 to <code>ebp - 8</code>:</p>
<pre><code class="language-arm"><span class="hljs-keyword">add</span> t2, t1
<span class="hljs-comment">// becomes</span>
<span class="hljs-keyword">mov</span> t44, [ebp - <span class="hljs-number">8</span>]
<span class="hljs-keyword">add</span> t44, t1
<span class="hljs-keyword">mov</span> [ebp - <span class="hljs-number">8</span>], t44
</code></pre>
<p>t44 has short liveness range =&gt; generates less interference =&gt; easier to allocate regs.</p>
<h3 id="x86-peculiarities">x86 peculiarities</h3>
<p>there are instructions that use regs in special ways:</p>
<ul>
<li><code>imul</code>: <code>eax</code> (use/def), <code>edx</code> (def)</li>
<li><code>jcxz/jecxz</code>: <code>ecx</code> (use)</li>
<li><code>call</code>: caller-save regs (def)</li>
<li>this means we have to add precolored nodes for machine regs
<ul>
<li>add edges accordingly</li>
<li>cannot cur pre-colored nodes in kampe's</li>
</ul>
</li>
</ul>
<p>vars live-out from call interfere with caller-save regs</p>
<ul>
<li>must use callee-save regs for the vars live out from a call</li>
<li>so prefer caller-save regs for the vars not live-out from a call</li>
</ul>
<h3 id="mov-coalescing"><code>mov</code> coalescing</h3>
<p>idea: can delete <code>mov t1, t2</code> if <code>t1</code> is assigned with r and <code>t2</code> is also assigned with r.</p>
<pre><code> \          /              \      /
-- t1 ---- t2 --   ==&gt;   --- t1/t2 ---
 /          \              /      \
     mov-
    related
</code></pre>
<p>but the result has higher degree and can fail graph coloring.</p>
<p><em>conservative coalescing</em>: never create nodes with &gt;= k high-degree neighbours</p>
<pre><code>             ----
             ----       /
many low-deg ----  t1/t2    (k-1) hi-deg neighbours
    nodes    ----       \
             ----
</code></pre>
<p><strong>algo.</strong> <em>(chaitin's)</em></p>
<ol>
<li>LVA and build interference graphs</li>
<li>chop off low-degree, non-mov-related nodes, and push them to a stack
<ul>
<li>now all nodes are high-degree or mov-related</li>
</ul>
</li>
<li>conservatively coalesce mov-related nodes
<ol>
<li>coalesced nodes may be non-mov-related =&gt; rerun from 2
<ul>
<li>all nodes are high-degree or mov-related</li>
<li>mov-related nodes cannot be conseratively coalesced</li>
</ul>
</li>
</ol>
</li>
<li>pick a mov-related node and mark it &quot;non-mov-related&quot; =&gt; rerun from 2
<ul>
<li>all nodes are high-degree</li>
</ul>
</li>
<li>optimistically color high degree nodes
<ol>
<li>choose a node, remove and push onto stack =&gt; may create low-deg nodes =&gt; rerun from 2
<ul>
<li>we have no nodes left in graph</li>
</ul>
</li>
</ol>
</li>
<li>pop nodes from stack and try coloring them</li>
<li>if failure, rewrite code to spill variables =&gt; code is now different =&gt; rerun from 1</li>
</ol>
<p>it has near-optimal result in practice, but very expensive.</p>
<h2 id="compiling-fp-features">compiling FP features</h2>
<p>first-class functions:</p>
<ul>
<li>assigned to variables</li>
<li>passe to functions as args</li>
<li>returned as return value</li>
<li>constructued at runtime</li>
</ul>
<p>challenges: higher-order function</p>
<pre><code class="language-scala">fun addfun(n: int): int -&gt; int {
    fun f(x: int): int {
        <span class="hljs-keyword">return</span> x + n
    }
    <span class="hljs-keyword">return</span> f
}
<span class="hljs-keyword">val</span> inc: int -&gt; int = addfun(<span class="hljs-number">1</span>)
inc(<span class="hljs-number">5</span>) <span class="hljs-comment">// 6</span>
</code></pre>
<p>function closure = code + env (aka static link)</p>
<pre><code>+-----------+
| inc  code --------&gt; f code
+-----------+
|      env  --------&gt; n = ...
+-----------+
</code></pre>
<p>closure conversion: convert free var access to env accesses</p>
<pre><code class="language-scala">fun f(env: f.env, x: int): int {
    <span class="hljs-keyword">return</span> x + env.n
}

inc.code(inc.env, <span class="hljs-number">5</span>)
</code></pre>
<p>envs are ideally on stack, in general on heap.</p>
<p><strong>eg.</strong></p>
<pre><code class="language-scala">fun twice(f: int -&gt; int): int -&gt; int {
    fun g(x: int): int {
        <span class="hljs-keyword">return</span> f(f(x))
    }
    <span class="hljs-keyword">return</span> g
}
fun double(n: int): int {
    fun addn(x: int): int {
        <span class="hljs-keyword">return</span> x + n
    }
    <span class="hljs-keyword">val</span> addnTwice: int -&gt; int = twice(addn)
    <span class="hljs-keyword">return</span> addnTwice(<span class="hljs-number">0</span>)
}
double(<span class="hljs-number">8</span>)
</code></pre>
<p>first need to do closure conversion:</p>
<pre><code class="language-scala">fun twice(f: f_clos) {
    <span class="hljs-keyword">val</span> g = create g closure
    <span class="hljs-keyword">return</span> g
}

<span class="hljs-comment">// hoist g</span>
fun g(env: g_env, y: int) {
    <span class="hljs-keyword">val</span> f = env.f
    <span class="hljs-keyword">return</span> f.code(f.env, f.code(f.env, y))
}

fun double(n: int): int {
    <span class="hljs-keyword">val</span> addn = create f closure
    <span class="hljs-keyword">val</span> addnTwice = twice(addn)
    <span class="hljs-keyword">return</span> addnTwice.code(addnTwice.env, <span class="hljs-number">0</span>)
}

<span class="hljs-comment">// hoise addn</span>
fun addn(env: addn_env, x: int) {
    <span class="hljs-keyword">return</span> x + env.n
}
</code></pre>
<p>call sequence/tree:</p>
<pre><code>      double
  1 /     2 \
twice    addnTwice(=g)
         3 /    4 \
        addn(=f) addn(=f)
</code></pre>
<p>when call reaches <code>twice</code>:<br>
<img src="assets/w12_1.PNG" alt="img"></p>
<p>when call leaves <code>twice</code> and reaches <code>addnTwice</code>:<br>
<img src="assets/w12_2.PNG" alt="img"></p>
<p>envs point to lexically enclosing func's activation =&gt; static link chains</p>
<ul>
<li>control flow is implicitly represented by stack pointer (not part of program)</li>
</ul>
<h3 id="cps-transformation">CPS transformation</h3>
<p>another approach: compiling with continuations</p>
<ul>
<li><em>contiuation-pass style (CPS)</em>: control flow explicit as continuation closures</li>
<li>first convert program to CPS, then do closure converstion</li>
<li>result program can compile and run without stack</li>
</ul>
<p>notations:</p>
<ul>
<li><code>[[v]] k</code> = e in CPS form, k is continuation function
<ul>
<li><code>v ::= n | x | fun(x1, ..., xn) {e} | halt</code> (value)</li>
</ul>
</li>
<li><code>[[e]] k</code> = e (expr) in CPS form
<ul>
<li><code>e ::= v | v0(v1, ..., vn) | v1 + v2 | let x = v in e | ...</code></li>
</ul>
</li>
<li><code>[[s]] k</code> = s (stmt) in CPS form
<ul>
<li><code>s ::= e | if v then s1 else s2 | s1; s2 | let x = v in s | ...</code></li>
</ul>
</li>
</ul>
<p>transformations:</p>
<ul>
<li><code>[[n]] k = k(n)</code></li>
<li><code>[[x]] k = k(x)</code></li>
<li><code>[[e1 + e2]] k = [[e1]] (fun x1 =&gt; [[e2]] (fun x2 =&gt; let x = x1 + x2 in k(x)))</code></li>
<li><code>[[if (e) then s1 else s2]] k = [[e]] (fun x =&gt; if x then [[s1]] k else [[s2]] k)</code></li>
<li><code>[[s1; s2]] k = [[s1]] (fun _ =&gt; [[s2]] k)</code></li>
<li><code>[[fun(x1, ..., xn){e}]] k = k(fun(x1, ..., xn, k'){[[e]] k'})</code> where <code>k'</code> is return addr</li>
<li><code>[[e0(e1, ..., en)]] k = [[e0]] (fun x0 =&gt; [[e1]] (fun x1 =&gt; ... [[en]] (fun xn =&gt; x0(x1, ..., xn, k)) ...))</code></li>
</ul>
<p><strong>eg.</strong></p>
<pre><code>[[1 + 2]] halt =
    (fun x1 =&gt; (fun x2 =&gt; let x = x1 + x2 in halt(x))) 2 1

[[inc(1 + 2)]] halt =
    (fun f =&gt; (fun x1 =&gt; (fun x2 =&gt; let x = x1 + x2 in f(x, halt)) 2) 1) inc
</code></pre>
<p>note all function calls are now tail calls =&gt; we do not need call stack or setting up call frames</p>
<pre><code class="language-arm"><span class="hljs-symbol">...</span>
<span class="hljs-comment">// call f</span>
<span class="hljs-comment">// ret</span>
<span class="hljs-symbol">jmp</span> f
</code></pre>
<p>cost: many 1st class functions (on heap) =&gt; gc overhead.</p>
<h1 id="week-13-apr-4">Week 13. Apr 4</h1>
<h2 id="constant-propagation-with-cond-branches">constant propagation (with cond branches)</h2>
<p>many important optimizations in single pass</p>
<ul>
<li>const folding</li>
<li>const propagation</li>
<li>identify unreachable code</li>
</ul>
<p>CPCB as dataflow analysis:</p>
<ul>
<li>D = forward</li>
<li>L = info about each var and unreachability
<ul>
<li>var info can be decomposed into components, each var is one component
<ul>
<li><code>L_x = {Top (T), Bottom (⊥)} ∪ Z</code>
<ul>
<li>T: var value is arbitrary (undefined/unreachable at the program point)</li>
<li>Z: var is constant</li>
<li>⊥: var may take multiple values</li>
<li>lattice of height 2</li>
</ul>
</li>
<li>meet function ∏:
<ul>
<li><code>c ∏ T = c</code></li>
<li><code>c ∏ ⊥ = ⊥</code></li>
<li><code>c1 ∏ c2 = ⊥</code> if <code>c1 != c2</code></li>
<li><code>c ∏ c = c</code></li>
</ul>
</li>
</ul>
</li>
<li><code>L = true|false × Lx × Ly × ...</code></li>
<li><code>ℓ = (unreachable?, (lx, ly, lz, ...)) ∈ L, lx, ... ∈ Lx</code></li>
<li>top element <code>T = (true, (T, T, T, ...))</code></li>
<li>partial ordering: componentwise</li>
<li>meet operator: componentwise (note multiple constants becomes bottom)</li>
</ul>
</li>
</ul>
<p><strong>eg.</strong><br>
<img src="assets/w13_1.PNG" alt="img"></p>
<p>transfer function <code>Fn(b, (v1, ..., vn))</code>:</p>
<ul>
<li><code>Fn(true, (...)) = (true, (T, ..., T))</code></li>
<li><code>Fn(false, (v1, ..., vn)) = (false, (v1', ..., vn'))</code>, where
<ul>
<li>if node is not assignment <code>xi &lt;- e</code>, then <code>vi' = vi</code></li>
<li>otherwise <code>vi' = </code><em>abstract interpretation of</em> e using <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>
<ul>
<li>ie try to evaluate e. eg <code>⊥+1=⊥, ⊥*0=0</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>eg.</strong> why do we not define lattice for Lx this way:<br>
<img src="assets/w13_2.PNG" alt="img"></p>
<p>it has infinite height. consider code</p>
<pre><code class="language-java"><span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) x = x + <span class="hljs-number">1</span>;
</code></pre>
<p>at each iteration, we might have <code>{0}, {0,1}, ...</code>, iterative solving will not finish.</p>
<p><strong>note.</strong> the meet operator is not distributive on this transfer function (unlike previous ones), ie <code>F(l1 ∏ l2) != F(l1) ∏ F(l2)</code>.</p>
<p><strong>eg.</strong></p>
<pre><code>+--------+     +--------+
| x = 1  |     | x = 2  |
| y = 2  |     | y = 1  |
+--------+     +--------+
    |              |
+---v----+     +---v----+
| t=x+y  |     | t=x+y  |
+--------+     +--------+
(false,(1,2,3)) ∏ (false,(2,1,3)) = (false, (⊥,⊥,3))

         +--------+     +--------+
         | x = 1  |     | x = 2  |
         | y = 2  |     | y = 1  |
         +--------+     +--------+
(false,(1,2,T)) \        / (false,(2,1,T))
              +--v--∏---v-+ (false,(⊥,⊥,T))
              |  t = x+y  |
              +-----------+
              (false,(⊥,⊥,⊥))
</code></pre>
<h3 id="abstract-interpretation">abstract interpretation</h3>
<p>it is semantic foundation of dataflow analyses.</p>
<p>two worlds:</p>
<ul>
<li>concrete computations operates on concrete values <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">v\in\Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">Z</span></span></span></span></li>
<li>abstract computations on abstract values <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo>∈</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">\tilde{ v}\in L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.707em;vertical-align:-0.0391em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">concrete world</th>
<th style="text-align:center">abstract world</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>v</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">v_1+v_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>v</mi><mo>~</mo></mover><mn>1</mn></msub><mo>+</mo><msub><mover accent="true"><mi>v</mi><mo>~</mo></mover><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\tilde{ v}_1+\tilde{v}_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8179em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8179em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_n(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F_n(\tilde{v})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td>
</tr>
</tbody>
</table>
<p><strong>defn.</strong> suppose we have a <em>concretion function</em> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>:</mo><mi>L</mi><mo>→</mo><msup><mn>2</mn><mi mathvariant="double-struck">Z</mi></msup></mrow><annotation encoding="application/x-tex">\gamma:L\to2^\Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8452em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8452em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">Z</span></span></span></span></span></span></span></span></span></span></span>, abstract interpretation is <em>sound</em> if, for all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo>∈</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">\tilde{v}\in L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.707em;vertical-align:-0.0391em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> and all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">v\in\Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">Z</span></span></span></span>, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mi>γ</mi><mo stretchy="false">(</mo><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v\in\gamma(\tilde{v})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>γ</mi><mo stretchy="false">(</mo><msub><mi>F</mi><mi>n</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_n(v)\in\gamma(F_n(\tilde{ v}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mclose">))</span></span></span></span>.</p>
<p><strong>notation.</strong> <em>abstraction function</em> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>:</mo><mo>=</mo><msup><mi>γ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\alpha:=\gamma^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>requirements:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo separator="true">,</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">\alpha,\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> are monotone:
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>S</mi><mn>2</mn></msub><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>α</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>≤</mo><mi>α</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_1\leq S_2\implies\alpha(S_1)\leq\alpha(S_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>v</mi><mo>~</mo></mover><mn>1</mn></msub><mo>≤</mo><msub><mover accent="true"><mi>v</mi><mo>~</mo></mover><mn>2</mn></msub><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>γ</mi><mo stretchy="false">(</mo><msub><mover accent="true"><mi>v</mi><mo>~</mo></mover><mn>1</mn></msub><mo stretchy="false">)</mo><mo>≤</mo><mi>γ</mi><mo stretchy="false">(</mo><msub><mover accent="true"><mi>v</mi><mo>~</mo></mover><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\tilde{v}_1\leq\tilde{v}_2\implies\gamma(\tilde{v}_1)\leq\gamma(\tilde{v}_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8179em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8179em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
</ul>
</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> is sound: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>≤</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">\gamma(\alpha(S))\leq S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> is complete (optimal): <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo>≤</mo><mi>α</mi><mo stretchy="false">(</mo><mi>γ</mi><mo stretchy="false">(</mo><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\tilde{v}\leq\alpha(\gamma(\tilde{v}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8038em;vertical-align:-0.136em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mclose">))</span></span></span></span></li>
</ul>
<p>given <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>, the most precise <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> is</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>γ</mi><mo stretchy="false">(</mo><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∏</mo><mrow><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo>≤</mo><mi>α</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow></munder><mi>S</mi><mo>=</mo><munder><mo>⋃</mo><mrow><mover accent="true"><mi>v</mi><mo>~</mo></mover><mo>≤</mo><mi>α</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow></munder><mi>S</mi></mrow><annotation encoding="application/x-tex">\gamma(\tilde{v})=\prod_{\tilde{v}\leq\alpha(S)}S=\bigcup_{\tilde{v}\leq\alpha(S)}S
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.566em;vertical-align:-1.516em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.809em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span><span style="top:-3.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord mtight">~</span></span></span></span></span></span></span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.566em;vertical-align:-1.516em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.809em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span><span style="top:-3.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord mtight">~</span></span></span></span></span></span></span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">⋃</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></span></p>
<p>there are more complex abstractions:</p>
<ul>
<li>range of values (cubical abstraction)</li>
<li>polyhedral abstractions (ML)</li>
<li>sign/pairing</li>
<li>nullability of pointers and memory locations (pointer analysis)</li>
</ul>
<h2 id="static-single-assignment">static single assignment</h2>
<p>SSA: every var has exactly 1 def.</p>
<p><strong>eg.</strong> it is easy for straight line CFGs</p>
<pre><code>x = 2         x1 = 2
  v
y = f(x)      y = f(x1)
  v
x = y         x2 = y
  v
z = x * 2     z = x2 * 2
</code></pre>
<p><strong>eg.</strong> it is hard for general CFG</p>
<pre><code>     x = 0
       v
+-&gt; if x &lt; 0
|   /      \
+ x=x+1    y=x
</code></pre>
<p>we use <em>φ-assignment</em></p>
<pre><code>     x1=0
       v
+-&gt; x3=φ(x1,x2)
|      v
|   if x3 &lt; 0
|    /       \
+ x2=x3+1    y=x3
</code></pre>
<p>why SSA: simplifies snalyses/optimizations.</p>
<ul>
<li>if we do LVA, we can store all uses of a var at var's def
<ul>
<li>x is live = x's use set is not empty</li>
</ul>
</li>
<li>if we do const propagation, then it is just replacing each use of x with c</li>
<li>dead code elimination:
<ul>
<li>without it, have to repeat analysis (eg <code>x=0;y=x;</code>, if y is dead, then have to do another analysis to find x is dead)</li>
<li>with SSA, after removing y, update x's use set</li>
</ul>
</li>
</ul>
<h3 id="conversion">conversion</h3>
<p>key problem: where to insert φ-assignments.</p>
<p><strong>defn.</strong> <em>(path convergence criterion)</em></p>
<ul>
<li>there are <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo mathvariant="normal">≠</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1\neq n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> that both def <code>x</code></li>
<li>there are proper paths <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>→</mo><mo>∗</mo><mi>m</mi><mo separator="true">,</mo><msub><mi>n</mi><mn>2</mn></msub><mo>→</mo><mo>∗</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n_1\rightarrow*m,n_2\rightarrow*m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord">∗</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord">∗</span><span class="mord mathnormal">m</span></span></span></span></li>
<li>the two paths are disjoint except at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></li>
<li>the two paths do not def <code>x</code> except at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1,n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>(m is the earliest place where two paths meet, and we want to insert phi here)</p>
<p>the arity of φ is the number of converging defs.</p>
<p><strong>defn.</strong> in a CFG, node A <em>dominates</em> node B if A is on every path from Start to B.</p>
<ul>
<li>it is reflexive: <code>A dom A</code></li>
<li>it is transitive: <code>A dom B ∧ B dom C =&gt; A dom C</code></li>
<li>it is antisymmetric: <code>A dom B ∧ B dom A =&gt; A=B</code></li>
</ul>
<p>so it is a partial order: <code>A dom C ∧ B dom C =&gt; A dom B ∨ B dom A</code>, hasse diagram is tree-like.</p>
<p><strong>eg.</strong><br>
<img src="assets/w13_3.PNG" alt="img"></p>
<p>dominator analysis as dataflow analysis:</p>
<ul>
<li>formula: <code>A dom B &lt;=&gt; A = B ∨ A dom predecessors(B)</code></li>
<li>facts: <code>out[n]</code>: set of nodes dominating n
<ul>
<li><code>out[n] = {n} ∪ </code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋃</mo><mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>≺</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bigcup_{n&#x27;\prec n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0771em;vertical-align:-0.3271em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1783em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel mtight">≺</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span></span></span></span><code>out[n']</code></li>
<li><code>out[Start] = {Start}</code></li>
</ul>
</li>
<li>L = all subsets of nodes</li>
<li>D: forward</li>
<li><code>Fn(l) = {n} ∪ l</code></li>
<li>meet operator: <code>∏=∪</code></li>
<li>Top T = all nodes</li>
</ul>
<p><strong>defn.</strong> m is in the <em>dominance frontier</em> <code>DF(n)</code> if</p>
<ul>
<li>n does not strictly dominate m</li>
<li>n dominates a predecessor of m</li>
</ul>
<p>we assume Start def's all vars.</p>
<p><strong>eg.</strong> <code>DF(E) = G</code>. <code>DF(A) = {A, G, Exit}</code>. <code>DF(D) = {A, Exit}.</code></p>
<p><strong>algo.</strong> <em>(iterative dominance frontiers for x)</em></p>
<ol>
<li>let S := set of nodes containing defs of x</li>
<li>let <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><msub><mi>F</mi><mn>0</mn></msub><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">DF_0=\varnothing</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6633em;vertical-align:-0.0817em;"></span><span class="mord amsrm">∅</span></span></span></span></li>
<li>while DF changes:
<ol>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><msub><mi>F</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>D</mi><msub><mi>F</mi><mi>i</mi></msub><mo>∪</mo><mi>S</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mo>⋃</mo><mrow><mi>n</mi><mo>∈</mo><mi>D</mi><msub><mi>F</mi><mi>i</mi></msub><mo>∪</mo><mi>S</mi></mrow></msub><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">DF_{i+1}=DF(DF_i\cup S)=\bigcup_{n\in DF_i\cup S}DF(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1498em;vertical-align:-0.3998em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">⋃</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">∪</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3998em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></li>
</ol>
</li>
</ol>
<p>we find a fixed point <code>x = DF(x ∪ S)</code>. we insert φ-assignments for variable x at these nodes.</p>
<p>how to find DF(n)? observation: let m be a node not strictly dominated by n, then <code>m ∈ DF(n)</code></p>
<ul>
<li>iff m has a predecessor dominated by n (defn.)</li>
<li>iff either m is a direct successor of n, or m is in DF(n') where n' is strictly dominated by n</li>
</ul>
<p><img src="assets/w13_4.PNG" alt="img"></p>
<p>in conclusion, to find DF(n),</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">(</mo><mo stretchy="false">{</mo><mi>m</mi><mo>:</mo><mi>n</mi><mo>≺</mo><mi>m</mi><mo stretchy="false">}</mo><mo>∪</mo><munder><mo>⋃</mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>n</mi><mtext> immediately </mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mtext> domates </mtext><mi>m</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></munder><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow><mo>−</mo><mo stretchy="false">{</mo><mi>m</mi><mo>:</mo><mi>n</mi><mtext> strictly doms </mtext><mi>m</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">DF(n)=\left(\{m:n\prec m\}\cup\bigcup_{\substack{n\text{ immediately }\\\text{ domates }m}}DF(m)\right)-\{m:n\text{ strictly doms }m\}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:4.4003em;vertical-align:-2.0503em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em;"><span style="top:-4.35em;"><span class="pstrut" style="height:6.2em;"></span><span style="width:0.875em;height:4.200em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='4.200em' viewBox='0 0 875 4200'><path d='M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,684c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-692c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em;"><span></span></span></span></span></span></span><span class="mopen">{</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≺</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.5418em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1317em;"><span style="top:-3.1372em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord text mtight"><span class="mord mtight"> immediately </span></span></span></span><span style="top:-2.2483em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight"> domates </span></span><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6317em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">⋃</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0503em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em;"><span style="top:-4.35em;"><span class="pstrut" style="height:6.2em;"></span><span style="width:0.875em;height:4.200em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='4.200em' viewBox='0 0 875 4200'><path d='M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,609
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-744c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord text"><span class="mord"> strictly doms </span></span><span class="mord mathnormal">m</span><span class="mclose">}</span></span></span></span></span></p>
<p>finally, we need to rename variables. we do by graph traversal.</p>
<p><img src="assets/w13_5.PNG" alt="img"></p>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>